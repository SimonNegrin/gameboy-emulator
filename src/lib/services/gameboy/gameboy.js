var e={6509:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="// Ring buffer reader class declared in the same file as the node since presently native js imports aren't supported\n// in worklet modules. There's probably a way with webpack bundling but just leaving it here for now. Actual node below.\nclass RingBufferReader {\n  constructor(sharedArrayBuffer, type) {\n    this.capacity = (sharedArrayBuffer.byteLength - 8) / type.BYTES_PER_ELEMENT;\n    this.buf = sharedArrayBuffer;\n    this.writePointer = new Uint32Array(this.buf, 0, 1);\n    this.readPointer = new Uint32Array(this.buf, 4, 1);\n    this.storage = new type(this.buf, 8, this.capacity);\n  }\n\n  pop(elements) {\n    const read = Atomics.load(this.readPointer, 0);\n    const write = Atomics.load(this.writePointer, 0);\n\n    const availableToRead = this.availableRead(read, write);\n\n    if (availableToRead === 0) {\n      return 0;\n    }\n\n    // Allows circular writing to array. Usually only the first call to copy is called, but if we are near the end\n    // of the array, the first copy writes up to the end, then the second copy writes the remainder at the start\n    const howManyToRead = Math.min(availableToRead, elements.length);\n    let sizeUpToEndOfArray = Math.min(this.capacity - read, howManyToRead);\n    let sizeFromStartOfTheArrayOrZero = howManyToRead - sizeUpToEndOfArray;\n\n    this.copy(this.storage, read, elements, 0, sizeUpToEndOfArray);\n    this.copy(this.storage, 0, elements, sizeUpToEndOfArray, sizeFromStartOfTheArrayOrZero);\n\n    const readPointerPositionAfterRead = (read + howManyToRead) % this.capacity;\n    Atomics.store(this.readPointer, 0, readPointerPositionAfterRead);\n\n    return howManyToRead;\n  }\n\n  isEmpty() {\n    const readPosition = Atomics.load(this.readPointer, 0);\n    const writePosition = Atomics.load(this.writePointer, 0);\n\n    return writePosition === readPosition;\n  }\n\n  dequeue(byteArray) {\n    if (this.isEmpty()) {\n      return 0;\n    }\n    return this.pop(byteArray);\n  }\n\n  availableRead(readPosition, writePosition) {\n    if (writePosition > readPosition) {\n      return writePosition - readPosition;\n    } else {\n      return writePosition + this.capacity - readPosition;\n    }\n  }\n\n  copy(input, inputOffset, output, outputOffset, size) {\n    for (let i = 0; i < size; i++) {\n      output[outputOffset + i] = input[inputOffset + i];\n    }\n  }\n}\n\n// Plays audio from its audio queue shared array buffer. Also allows parameters to be changed via index.\n// Currently parameter changes aren't used, but might be in the future. Current implementation supports gain, but\n// for gameboy that is determined by the gameboy logic itself.\nclass RingBufferProcessor extends AudioWorkletProcessor {\n  static get parameterDescriptors() {\n    return [];\n  }\n\n  constructor(options) {\n    super(options);\n\n    const parameterIndexByteSize = 1;\n    const parameterValueByteSize = 4;\n    const arrayBufferSize = parameterIndexByteSize + parameterValueByteSize;\n    this.rawStorage = new ArrayBuffer(arrayBufferSize);\n    this.byteArray = new Uint8Array(this.rawStorage);\n    this.dataView = new DataView(this.rawStorage);\n\n    this.interleaved = new Float32Array(128);\n    this.amp = 1.0;\n    this.parameterObject = { index: 0, value: 0 };\n    const { audioQueue, paramQueue } = options.processorOptions;\n    this.audioReadBuffer = new RingBufferReader(audioQueue, Float32Array);\n    this.paramReadBuffer = new RingBufferReader(paramQueue, Uint8Array);\n  }\n\n  dequeueParameterChange() {\n    if (this.paramReadBuffer.isEmpty()) {\n      return false;\n    }\n    this.paramReadBuffer.pop(this.byteArray);\n    this.parameterObject.index = this.dataView.getUint8(0);\n    this.parameterObject.value = this.dataView.getFloat32(1);\n\n    return true;\n  }\n\n  process(inputs, outputs) {\n    // Get any param changes\n    if (this.dequeueParameterChange(this.parameterObject)) {\n      console.log(\"param change: \", this.parameterObject.index, this.parameterObject.value);\n      this.amp = this.parameterObject.value;\n    }\n\n    this.audioReadBuffer.dequeue(this.interleaved);\n\n    for (var i = 0; i < 128; i++) {\n      outputs[0][0][i] = this.amp * this.interleaved[i]\n    }\n\n    return true;\n  }\n}\n\nregisterProcessor('ring-buffer-processor', RingBufferProcessor);\n"},5991:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.APU=void 0;const i=r(9145),s=r(8107),n=r(1710),a=r(6283),o=r(3893),u=r(3210);class l{constructor(){this.FrameSequencerInterval=i.CPU.OperatingHertz/l.FrameSequencerHertz,this.audioContext=new AudioContext({sampleRate:44100}),this.frameSequencerCycleCounter=0,this.cyclesPerSample=i.CPU.OperatingHertz/this.audioContext.sampleRate,this.sampleCycleCounter=0,this._isAudioEnabled=!1,this.frameSequencerStep=0,this.audioContext.suspend();try{SharedArrayBuffer}catch(e){console.log("%cAudio requires SharedArrayBuffer","font-family:sans-serif; font-size: 20px"),console.log("This emulator uses a SharedArrayBuffer for buffered audio on a separate thread. To use shared array buffer you must use https and add the following headers to your server:"),console.log("%c'Cross-Origin-Opener-Policy': 'same-origin', \n'Cross-Origin-Embedder-Policy': 'require-corp'","font-family:monospace;")}this.ringBufferPlayer=new u.RingBufferPlayer(this.audioContext,1024),this.sound1=new s.Sound1,this.sound2=new n.Sound2,this.sound3=new o.Sound3,this.sound4=new a.Sound4}get isAudioEnabled(){return this._isAudioEnabled}enableSound(){this._isAudioEnabled=!0,this.audioContext.resume()}disableSound(){this._isAudioEnabled=!1,this.audioContext.suspend()}tick(e){this._isAudioEnabled&&(this.sound1.tick(e),this.sound2.tick(e),this.sound3.tick(e),this.sound4.tick(e),this.sampleCycleCounter+=e,this.sampleCycleCounter>=this.cyclesPerSample&&(this.sampleChannels(),this.sampleCycleCounter-=this.cyclesPerSample),this.frameSequencerCycleCounter+=e,this.frameSequencerCycleCounter>=this.FrameSequencerInterval&&(this.advanceFrameSequencer(),this.frameSequencerCycleCounter-=this.FrameSequencerInterval))}sampleChannels(){const e=(this.sound1.getSample()+this.sound2.getSample()+this.sound3.getSample()+this.sound4.getSample())/4;this.ringBufferPlayer.writeSample(e)}advanceFrameSequencer(){switch(this.frameSequencerStep){case 0:this.clockLength();break;case 2:this.clockLength(),this.clockSweep();break;case 4:this.clockLength();break;case 6:this.clockLength(),this.clockSweep();break;case 7:this.clockVolume()}this.frameSequencerStep++,8===this.frameSequencerStep&&(this.frameSequencerStep=0)}clockLength(){this.sound1.clockLength(),this.sound2.clockLength(),this.sound3.clockLength(),this.sound4.clockLength()}clockSweep(){this.sound1.clockSweep()}clockVolume(){this.sound1.clockVolume(),this.sound2.clockVolume(),this.sound4.clockVolume()}}t.APU=l,l.FrameSequencerHertz=512},7637:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Enveloper=void 0,t.Enveloper=class{constructor(){this.envelopePeriodTimer=0}initializeTimer(e){this.envelopePeriodTimer=e}clockVolume(e,t){const{lengthOfEnvelopeStep:r,isEnvelopeRising:i}=t;if(0===r)return e;if(this.envelopePeriodTimer>0&&this.envelopePeriodTimer--,0===this.envelopePeriodTimer){if(this.envelopePeriodTimer=r,i&&e<15)return e+1;if(!i&&e>0)return e-1}return e}}},8343:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound4EnvelopeControlRegister=t.sound2EnvelopeControlRegister=t.sound1EnvelopeControlRegister=t.EnvelopeControlRegister=void 0;const i=r(8254);class s{constructor(e,t){this.offset=e,this.name=t}get value(){return i.memory.readByte(this.offset)}get initialVolume(){return this.value>>4}get isEnvelopeRising(){return 1==(this.value>>3&1)}get lengthOfEnvelopeStep(){return 7&this.value}}t.EnvelopeControlRegister=s,t.sound1EnvelopeControlRegister=new s(65298,"NR12"),t.sound2EnvelopeControlRegister=new s(65303,"NR22"),t.sound4EnvelopeControlRegister=new s(65313,"NR42")},9550:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound3HighOrderFrequencyRegister=t.sound2HighOrderFrequencyRegister=t.sound1HighOrderFrequencyRegister=t.HighOrderFrequencyRegister=void 0;const i=r(5425),s=r(8254);class n{constructor(e,t){this.offset=e,this.name=t}get value(){return s.memory.readByte(this.offset)}get highOrderFrequencyRegister(){return this.value}get isInitialize(){return this.value>>7==1}set isInitialize(e){const t=i.setBit(this.value,7,e?1:0);s.memory.writeByte(this.offset,t)}get isContinuousSelection(){return 0==(this.value>>6&1)}get highOrderFrequencyData(){return 7&this.value}}t.HighOrderFrequencyRegister=n,t.sound1HighOrderFrequencyRegister=new n(65300,"NR14"),t.sound2HighOrderFrequencyRegister=new n(65305,"NR24"),t.sound3HighOrderFrequencyRegister=new n(65310,"NR34")},1280:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound2LengthAndDutyCycleRegister=t.sound1LengthAndDutyCycleRegister=t.LengthAndDutyCycleRegister=void 0;const i=r(8254);class s{constructor(e,t){this.offset=e,this.name=t}get value(){return i.memory.readByte(this.offset)}get waveformDutyCycle(){return this.value>>6}get soundLength(){return 63&this.value}}t.LengthAndDutyCycleRegister=s,t.sound1LengthAndDutyCycleRegister=new s(65297,"NR11"),t.sound2LengthAndDutyCycleRegister=new s(65302,"NR21")},1090:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound3LowOrderFrequencyRegister=t.sound2LowOrderFrequencyRegister=t.sound1LowOrderFrequencyRegister=t.LowOrderFrequencyRegisters=void 0;const i=r(8254);class s{constructor(e,t){this.offset=e,this.name=t}get value(){return i.memory.readByte(this.offset)}}t.LowOrderFrequencyRegisters=s,t.sound1LowOrderFrequencyRegister=new s(65299,"NR13"),t.sound2LowOrderFrequencyRegister=new s(65304,"NR23"),t.sound3LowOrderFrequencyRegister=new s(65309,"NR33")},9229:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound3LengthRegister=t.Sound3LengthRegister=void 0;const i=r(8254);class s{constructor(){this.offset=65307,this.name="NR31"}get value(){return i.memory.readByte(this.offset)}}t.Sound3LengthRegister=s,t.sound3LengthRegister=new s},9564:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound3OutputLevelRegister=t.Sound3OutputLevelRegister=void 0;const i=r(8254);class s{constructor(){this.offset=65308,this.name="NR32"}get value(){return i.memory.readByte(this.offset)}get outputLevel(){return this.value>>5&3}}t.Sound3OutputLevelRegister=s,t.sound3OutputLevelRegister=new s},1436:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound4ContinuousSelectionRegister=t.Sound4ContinuousSelectionRegister=void 0;const i=r(8254),s=r(5425);class n{constructor(){this.offset=65315,this.name="NR44"}get value(){return i.memory.readByte(this.offset)}get isInitialize(){return this.value>>7==1}set isInitialize(e){const t=s.setBit(this.value,7,e?1:0);i.memory.writeByte(this.offset,t)}get isContinuousSelection(){return 0==(this.value>>6&1)}}t.Sound4ContinuousSelectionRegister=n,t.sound4ContinuousSelectionRegister=new n},5352:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound4LengthRegister=t.Sound4LengthRegister=void 0;const i=r(8254);class s{constructor(){this.offset=65312,this.name="NR41"}get value(){return i.memory.readByte(this.offset)}get soundLength(){return 63&this.value}}t.Sound4LengthRegister=s,t.sound4LengthRegister=new s},9999:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound4PolynomialRegister=void 0;const i=r(8254);t.sound4PolynomialRegister=new class{constructor(){this.offset=65314,this.name="NR43",this.divisors=[8,16,32,48,64,80,96,112]}get value(){return i.memory.readByte(this.offset)}get clockShift(){return this.value>>4}get counterWidth(){return 1==(this.value>>3&1)?7:15}get dividingRatio(){return 3&this.value}get divisor(){const e=7&this.value;return this.divisors[e]}get frequency(){const e=this.dividingRatio;return 524288/(0===e?.5:e)/Math.pow(2,this.clockShift+1)}}},6001:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.soundsOnRegister=void 0;const i=r(8254),s=r(5425);t.soundsOnRegister=new class{constructor(){this.offset=65318,this.name="NR52"}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}get isAllSoundOn(){return 1==(this.value>>7&1)}get isSound4On(){return 1==(this.value>>3&1)}get isSound3On(){return 1==(this.value>>2&1)}get isSound2On(){return 1==(this.value>>1&1)}get isSound1On(){return 1==(1&this.value)}set isSound1On(e){this.value=s.setBit(this.value,0,e?1:0)}set isSound2On(e){this.value=s.setBit(this.value,1,e?1:0)}set isSound3On(e){this.value=s.setBit(this.value,2,e?1:0)}set isSound4On(e){this.value=s.setBit(this.value,3,e?1:0)}}},5014:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sweepControlRegister=t.SweepControlRegister=void 0;const i=r(8254);class s{constructor(){this.offset=65297,this.name="NR11"}get value(){return i.memory.readByte(this.offset)}get sweepTime(){return this.value>>4&7}get sweepTimeInSeconds(){return this.sweepTime/1280}get isSweepIncrease(){return 1==(this.value>>3&1)}get sweepAmount(){return 7&this.value}}t.SweepControlRegister=s,t.sweepControlRegister=new s},3210:function(e,t,r){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RingBufferPlayer=void 0;const s=r(2298),n=i(r(6509));t.RingBufferPlayer=class{constructor(e,t){this.sampleBufferIndex=0,this.sampleBuffer=new Float32Array(t),this.parameterRawStorage=new ArrayBuffer(5),this.parameterByteArray=new Uint8Array(this.parameterRawStorage),this.parameterDataView=new DataView(this.parameterRawStorage),e.audioWorklet.addModule(this.getModuleFile()).then((()=>{const t=s.RingBufferWriter.GetSharedArrayBufferForCapacity(e.sampleRate/20,Float32Array);this.audioRingBufferWriter=new s.RingBufferWriter(t,Float32Array);const r=s.RingBufferWriter.GetSharedArrayBufferForCapacity(32,Uint8Array);this.parameterRingBufferWriter=new s.RingBufferWriter(r,Uint8Array),this.ringBufferPlayerNode=new AudioWorkletNode(e,"ring-buffer-processor",{processorOptions:{audioQueue:t,paramQueue:r}}),this.ringBufferPlayerNode.connect(e.destination)}))}writeSample(e){this.sampleBuffer[this.sampleBufferIndex]=e,this.sampleBufferIndex++,this.sampleBufferIndex===this.sampleBuffer.length&&(this.audioRingBufferWriter?.push(this.sampleBuffer),this.sampleBufferIndex=0)}writeParameter(e,t){return this.parameterDataView.setUint8(0,e),this.parameterDataView.setFloat32(1,t),!(!this.parameterRingBufferWriter||this.parameterRingBufferWriter.availableWrite()<this.parameterRawStorage.byteLength)&&this.parameterRingBufferWriter&&this.parameterRingBufferWriter.push(this.parameterByteArray)===this.parameterRawStorage.byteLength}getModuleFile(){const e=n.default,t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}}},2298:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RingBufferWriter=void 0;class r{constructor(e,t){this.capacity=(e.byteLength-r.SizeOfPointers)/t.BYTES_PER_ELEMENT,this.sharedBuffer=e,this.writePointer=new Uint32Array(this.sharedBuffer,0,1),this.readPointer=new Uint32Array(this.sharedBuffer,4,1),this.storage=new t(this.sharedBuffer,8,this.capacity)}static GetSharedArrayBufferForCapacity(e,t){const i=(e+1)*t.BYTES_PER_ELEMENT+r.SizeOfPointers;return new SharedArrayBuffer(i)}push(e){const t=Atomics.load(this.readPointer,0),r=Atomics.load(this.writePointer,0),i=this._availableWrite(t,r);if(0===i)return console.log("full"),0;const s=Math.min(i,e.length),n=Math.min(this.capacity-r,s),a=s-n;this.copy(e,0,this.storage,r,n),this.copy(e,n,this.storage,0,a);const o=(r+s)%this.capacity;return Atomics.store(this.writePointer,0,o),s}availableWrite(){const e=Atomics.load(this.readPointer,0),t=Atomics.load(this.writePointer,0);return this._availableWrite(e,t)}_availableWrite(e,t){let r=e-t-1;return t>=e&&(r+=this.capacity),r}copy(e,t,r,i,s){for(let n=0;n<s;n++)r[i+n]=e[t+n]}}t.RingBufferWriter=r,r.WritePointerByteSize=4,r.ReadPointerByteSize=4,r.SizeOfPointers=r.WritePointerByteSize+r.ReadPointerByteSize},8107:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Sound1=void 0;const i=r(8254),s=r(7637),n=r(8343),a=r(5014),o=r(1280),u=r(9550),l=r(1090),c=r(6001);t.Sound1=class{constructor(){this.dutyCycles=[[0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1],[1,0,0,0,0,1,1,1],[0,1,1,1,1,1,1,0]],this.positionInDutyCycle=0,this.frequencyTimer=0,this.frequencyPeriod=this.getFrequencyPeriod(),this.lengthTimer=0,this.enveloper=new s.Enveloper,this.volume=0,this.isSweepEnabled=!1,this.shadowFrequency=0,this.sweepTimer=0}tick(e){u.sound1HighOrderFrequencyRegister.isInitialize&&(this.playSound(),u.sound1HighOrderFrequencyRegister.isInitialize=!1),this.frequencyTimer-=e,this.frequencyTimer<=0&&(this.frequencyTimer+=this.frequencyPeriod,this.positionInDutyCycle=(this.positionInDutyCycle+1)%8)}playSound(){c.soundsOnRegister.isSound1On=!0,this.frequencyPeriod=this.getFrequencyPeriod(),this.frequencyTimer=this.frequencyPeriod,this.volume=n.sound1EnvelopeControlRegister.initialVolume,this.enveloper.initializeTimer(n.sound1EnvelopeControlRegister.lengthOfEnvelopeStep),this.lengthTimer=64-o.sound1LengthAndDutyCycleRegister.soundLength}clockLength(){u.sound1HighOrderFrequencyRegister.isContinuousSelection||(this.lengthTimer--,0===this.lengthTimer&&(c.soundsOnRegister.isSound1On=!1))}clockVolume(){this.volume=this.enveloper.clockVolume(this.volume,n.sound1EnvelopeControlRegister)}clockSweep(){if(this.sweepTimer>0&&this.sweepTimer--,0===this.sweepTimer&&(this.resetSweepTimer(),this.isSweepEnabled&&a.sweepControlRegister.sweepTime>0)){const e=this.calculateNewSweepFrequency();e<2048&&a.sweepControlRegister.sweepAmount>0&&(this.shadowFrequency=e,this.frequencyPeriod=4*(2048-e))}}resetSweepTimer(){this.sweepTimer=a.sweepControlRegister.sweepTime,0===this.sweepTimer&&(this.sweepTimer=8)}calculateNewSweepFrequency(){const{sweepAmount:e,isSweepIncrease:t}=a.sweepControlRegister,r=this.shadowFrequency>>e,i=t?-r:r,s=this.shadowFrequency+i;return s>=2048&&(c.soundsOnRegister.isSound1On=!1),s}getSample(){const e=this.dutyCycles[o.sound1LengthAndDutyCycleRegister.waveformDutyCycle][this.positionInDutyCycle];return c.soundsOnRegister.isSound1On?e*this.volume/15:0}getFrequencyPeriod(){return 4*(2048-(2047&i.memory.readWord(l.sound1LowOrderFrequencyRegister.offset)))}}},1710:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Sound2=void 0;const i=r(8254),s=r(7637),n=r(8343),a=r(9550),o=r(1280),u=r(1090),l=r(6001);t.Sound2=class{constructor(){this.dutyCycles=[[0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1],[1,0,0,0,0,1,1,1],[0,1,1,1,1,1,1,0]],this.positionInDutyCycle=0,this.frequencyTimer=0,this.frequencyPeriod=this.getFrequencyPeriod(),this.lengthTimer=0,this.enveloper=new s.Enveloper,this.volume=0}tick(e){a.sound2HighOrderFrequencyRegister.isInitialize&&(this.playSound(),a.sound2HighOrderFrequencyRegister.isInitialize=!1),this.frequencyTimer-=e,this.frequencyTimer<=0&&(this.frequencyTimer+=this.frequencyPeriod,this.positionInDutyCycle=(this.positionInDutyCycle+1)%8)}playSound(){l.soundsOnRegister.isSound2On=!0,this.frequencyPeriod=this.getFrequencyPeriod(),this.frequencyTimer=this.frequencyPeriod,this.volume=n.sound2EnvelopeControlRegister.initialVolume,this.enveloper.initializeTimer(n.sound2EnvelopeControlRegister.lengthOfEnvelopeStep),this.lengthTimer=64-o.sound2LengthAndDutyCycleRegister.soundLength}clockLength(){a.sound2HighOrderFrequencyRegister.isContinuousSelection||(this.lengthTimer--,0===this.lengthTimer&&(l.soundsOnRegister.isSound2On=!1))}clockVolume(){this.volume=this.enveloper.clockVolume(this.volume,n.sound2EnvelopeControlRegister)}getSample(){const e=this.dutyCycles[o.sound2LengthAndDutyCycleRegister.waveformDutyCycle][this.positionInDutyCycle];return l.soundsOnRegister.isSound2On&&this.volume>0?e*this.volume/15:0}getFrequencyPeriod(){return 4*(2048-(2047&i.memory.readWord(u.sound2LowOrderFrequencyRegister.offset)))}}},3893:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Sound3=void 0;const i=r(8254),s=r(9550),n=r(9564),a=r(1090),o=r(6001),u=r(5425),l=r(9229);t.Sound3=class{constructor(){this.frequencyTimer=0,this.frequencyPeriod=this.getFrequencyPeriod(),this.lengthTimer=0,this.waveTableMemoryAddress=65328,this.waveTablePosition=0,this.shifts=[4,0,1,2]}tick(e){s.sound3HighOrderFrequencyRegister.isInitialize&&(this.playSound(),s.sound3HighOrderFrequencyRegister.isInitialize=!1),this.frequencyTimer-=e,this.frequencyTimer<=0&&(this.frequencyTimer+=this.frequencyPeriod,this.waveTablePosition++,32===this.waveTablePosition&&(this.waveTablePosition=0))}playSound(){o.soundsOnRegister.isSound3On=!0,this.waveTablePosition=0,this.frequencyPeriod=this.getFrequencyPeriod(),this.frequencyTimer=this.frequencyPeriod,this.lengthTimer=256-l.sound3LengthRegister.value}clockLength(){s.sound3HighOrderFrequencyRegister.isContinuousSelection||(this.lengthTimer--,0===this.lengthTimer&&(o.soundsOnRegister.isSound3On=!1))}getSample(){const e=Math.floor(this.waveTablePosition/2),t=i.memory.readByte(this.waveTableMemoryAddress+e),r=(this.waveTablePosition%2==1?u.getLowerNibble(t):u.getUpperNibble(t))>>this.shifts[n.sound3OutputLevelRegister.outputLevel];return o.soundsOnRegister.isSound3On&&0!==n.sound3OutputLevelRegister.outputLevel?r/15:0}getFrequencyPeriod(){return 2*(2048-(2047&i.memory.readWord(a.sound3LowOrderFrequencyRegister.offset)))}}},6283:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Sound4=void 0;const i=r(7637),s=r(5425),n=r(9999),a=r(8343),o=r(1436),u=r(5352),l=r(6001);t.Sound4=class{constructor(){this.frequencyTimer=0,this.frequencyPeriod=this.getFrequencyPeriod(),this.lengthTimer=0,this.enveloper=new i.Enveloper,this.volume=0,this.linearFeedbackShift=0}tick(e){o.sound4ContinuousSelectionRegister.isInitialize&&(this.playSound(),o.sound4ContinuousSelectionRegister.isInitialize=!1),this.frequencyTimer-=e,this.frequencyTimer<=0&&(this.frequencyTimer=this.getFrequencyPeriod(),this.stepLinearFeedbackShift())}getFrequencyPeriod(){return n.sound4PolynomialRegister.divisor<<n.sound4PolynomialRegister.clockShift}playSound(){l.soundsOnRegister.isSound4On=!0,this.linearFeedbackShift=32767,this.frequencyPeriod=this.getFrequencyPeriod(),this.frequencyTimer=this.frequencyPeriod,this.volume=a.sound4EnvelopeControlRegister.initialVolume,this.enveloper.initializeTimer(a.sound4EnvelopeControlRegister.lengthOfEnvelopeStep),this.lengthTimer=64-u.sound4LengthRegister.soundLength}clockLength(){o.sound4ContinuousSelectionRegister.isContinuousSelection||(this.lengthTimer--,0===this.lengthTimer&&(l.soundsOnRegister.isSound4On=!1))}clockVolume(){this.volume=this.enveloper.clockVolume(this.volume,a.sound4EnvelopeControlRegister)}stepLinearFeedbackShift(){const e=s.getBit(this.linearFeedbackShift,0),t=s.getBit(this.linearFeedbackShift,1)^e;this.linearFeedbackShift>>=1,this.linearFeedbackShift=s.setBit(this.linearFeedbackShift,14,t),7===n.sound4PolynomialRegister.counterWidth&&(this.linearFeedbackShift=s.setBit(this.linearFeedbackShift,6,t))}getSample(){const e=1&~this.linearFeedbackShift;return l.soundsOnRegister.isSound4On&&this.volume>0?e*this.volume/15:0}}},7189:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CartridgeLoader=void 0;const i=r(3426),s=r(9268),n=r(9259),a=r(1992);class o{static FromArrayBuffer(e){const t=new DataView(e);switch(t.getUint8(o.TypeOffset)){case i.CartridgeType.ROM:return new n.Cartridge(t);case i.CartridgeType.MBC1:case i.CartridgeType.MBC1_RAM:case i.CartridgeType.MBC1_RAM_BATTERY:return new s.Mbc1Cartridge(t);case i.CartridgeType.MBC3:case i.CartridgeType.MBC3_RAM:case i.CartridgeType.MBC3_RAM_BATTERY:case i.CartridgeType.MBC3_TIMER_BATTERY:case i.CartridgeType.MBC3_TIMER_RAM_BATTERY:return new a.Mbc3Cartridge(t);default:return alert("oops not ready"),new n.Cartridge(t)}}}t.CartridgeLoader=o,o.TypeOffset=327},3426:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.CartridgeType=void 0,(r=t.CartridgeType||(t.CartridgeType={}))[r.ROM=0]="ROM",r[r.MBC1=1]="MBC1",r[r.MBC1_RAM=2]="MBC1_RAM",r[r.MBC1_RAM_BATTERY=3]="MBC1_RAM_BATTERY",r[r.MBC2=5]="MBC2",r[r.MBC2_BATTERY=6]="MBC2_BATTERY",r[r.ROM_RAM=8]="ROM_RAM",r[r.ROM_RAM_BATTERY=9]="ROM_RAM_BATTERY",r[r.MMM01=11]="MMM01",r[r.MMM01_RAM=12]="MMM01_RAM",r[r.MMM01_RAM_BATTERY=13]="MMM01_RAM_BATTERY",r[r.MBC3_TIMER_BATTERY=15]="MBC3_TIMER_BATTERY",r[r.MBC3_TIMER_RAM_BATTERY=16]="MBC3_TIMER_RAM_BATTERY",r[r.MBC3=17]="MBC3",r[r.MBC3_RAM=18]="MBC3_RAM",r[r.MBC3_RAM_BATTERY=19]="MBC3_RAM_BATTERY",r[r.MBC5=25]="MBC5",r[r.MBC5_RAM=26]="MBC5_RAM",r[r.MBC5_RAM_BATTERY=27]="MBC5_RAM_BATTERY",r[r.MBC5_RUMBLE=28]="MBC5_RUMBLE",r[r.MBC5_RUMBLE_RAM=29]="MBC5_RUMBLE_RAM",r[r.MBC5_RUMBLE_RAM_BATTERY=30]="MBC5_RUMBLE_RAM_BATTERY",r[r.MBC6=32]="MBC6",r[r.MBC7_SENSOR_RUMBLE_RAM_BATTERY=34]="MBC7_SENSOR_RUMBLE_RAM_BATTERY",r[r.POCKET_CAMERA=252]="POCKET_CAMERA",r[r.BANDAI_TAMA5=253]="BANDAI_TAMA5",r[r.HuC3=254]="HuC3",r[r.HuC1_RAM_BATTERY=255]="HuC1_RAM_BATTERY"},9259:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Cartridge=void 0;const i=r(3426);class s{constructor(e){this.gameDataView=e,this.gameBytes=new Uint8Array(e.buffer)}readByte(e){return this.gameDataView.getUint8(e)}readSignedByte(e){return this.gameDataView.getInt8(e)}readWord(e){return this.gameDataView.getUint16(e,!0)}writeByte(e,t){}writeWord(e,t){}get title(){const e=new TextDecoder,t=this.gameBytes.subarray(308,323);return e.decode(t)}get typeName(){const e=this.gameDataView.getUint8(327);return i.CartridgeType[e]}get type(){return this.gameDataView.getUint8(327)}get romSize(){return[32768,65536,131072,262144,524288,1048576,2097152,4096,8192][this.gameDataView.getUint8(328)]}get ramSize(){return[0,8192,32768,204800,1212416,5316608][this.gameDataView.getUint8(329)]}get versionNumber(){return this.gameDataView.getUint8(332)}get hasSaveableRam(){return s.TypesWithBatterySave.includes(this.type)}}t.Cartridge=s,s.EntryPointOffset=256,s.TypesWithBatterySave=[i.CartridgeType.ROM_RAM_BATTERY,i.CartridgeType.MBC1_RAM_BATTERY,i.CartridgeType.MBC2_BATTERY,i.CartridgeType.MBC3_RAM_BATTERY]},9268:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Mbc1Cartridge=void 0;const i=r(9259),s=r(3426);var n,a;!function(e){e[e.RamGateRegister=0]="RamGateRegister",e[e.Bank1Register=1]="Bank1Register",e[e.Bank2Register=2]="Bank2Register",e[e.ModeRegister=3]="ModeRegister",e[e.Sram=4]="Sram"}(n||(n={})),function(e){e[e.RomBankZero=0]="RomBankZero",e[e.RomBankZeroMode1=1]="RomBankZeroMode1",e[e.RomBank=2]="RomBank",e[e.Sram=3]="Sram",e[e.Invalid=4]="Invalid"}(a||(a={}));class o extends i.Cartridge{constructor(e){super(e),this.isRamEnabled=!1,this.bank1=1,this.bank2=0,this.mode=0,this.ramData=new ArrayBuffer(this.ramSize),this.ramDataView=new DataView(this.ramData),this.ramBytes=new Uint8Array(this.ramDataView.buffer),this.ramBytes.fill(255)}setRam(e){this.ramData=e,this.ramDataView=new DataView(this.ramData),this.ramBytes=new Uint8Array(this.ramDataView.buffer)}dumpRam(){return this.ramDataView.buffer}writeByte(e,t){this.write(e,t,((e,t)=>{this.ramDataView.setUint8(e,t),this.type===s.CartridgeType.MBC1_RAM_BATTERY&&this.onSramWrite&&(clearTimeout(this.writeTimeout),this.writeTimeout=setTimeout((()=>this.onSramWrite(this.ramData)),500))}))}writeWord(e,t){this.write(e,t,((e,t)=>{this.ramDataView.setUint16(e,t,!0),this.type===s.CartridgeType.MBC1_RAM_BATTERY&&this.onSramWrite&&(clearTimeout(this.writeTimeout),this.writeTimeout=setTimeout((()=>this.onSramWrite(this.ramData)),500))}))}readByte(e){return this.read(e,(e=>this.gameDataView.getUint8(e)),(e=>this.ramDataView.getUint8(e)))}readSignedByte(e){return this.read(e,(e=>this.gameDataView.getInt8(e)),(e=>this.ramDataView.getInt8(e)))}readWord(e){return this.read(e,(e=>this.gameDataView.getUint16(e,!0)),(e=>this.ramDataView.getUint16(e,!0)))}read(e,t,r){const i=16383&e;if(e>=0&&e<=16383)return 0===this.mode?t(i):t((this.bank2<<5<<14)+i&this.romSize-1);if(e>=16384&&e<=32767)return t(((this.bank2<<5)+this.bank1<<14)+i&this.romSize-1);{if(!this.isRamEnabled)return 255;const t=8191&e;return 0===this.mode||32768===this.ramSize?r(t):r((this.bank2<<13)+t)}}write(e,t,r){if(this.isRamGate(e)){const e=10,r=15&t;this.isRamEnabled=r===e}else if(this.isBank1(e)){const e=31&t;this.bank1=0===e?1:e}else if(this.isBank2(e))this.bank2=3&t;else if(this.isMode(e))this.mode=1&t;else if(this.isRam(e)&&this.isRamEnabled){const i=8191&e;0===this.mode||32768===this.ramSize?r(i,t):r((this.bank2<<13)+i,t)}}isRamGate(e){return e>=0&&e<=8191}isBank1(e){return e>=8192&&e<=16383}isBank2(e){return e>=16384&&e<=24575}isMode(e){return e>=24576&&e<=32767}isRam(e){return e>=40960&&e<=49151}}t.Mbc1Cartridge=o},1992:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Mbc3Cartridge=void 0;const i=r(9259),s=r(3426);class n extends i.Cartridge{constructor(e){super(e),this.romBank=0,this.isRamAndRtcEnabled=!1,this.ramBankOrRtcSelection=0,this.ramData=new ArrayBuffer(this.ramSize),this.ramDataView=new DataView(this.ramData),this.ramBytes=new Uint8Array(this.ramDataView.buffer),this.ramBytes.fill(255)}setRam(e){this.ramData=e,this.ramDataView=new DataView(this.ramData),this.ramBytes=new Uint8Array(this.ramDataView.buffer)}dumpRam(){return this.ramDataView.buffer}writeByte(e,t){this.write(e,t,((e,t)=>{this.ramDataView.setUint8(e,t),this.type===s.CartridgeType.MBC3_RAM_BATTERY&&this.onSramWrite&&(clearTimeout(this.writeTimeout),this.writeTimeout=setTimeout((()=>this.onSramWrite(this.ramData)),500))}))}writeWord(e,t){this.write(e,t,((e,t)=>{this.ramDataView.setUint16(e,t,!0),this.type===s.CartridgeType.MBC3_RAM_BATTERY&&this.onSramWrite&&(clearTimeout(this.writeTimeout),this.writeTimeout=setTimeout((()=>this.onSramWrite(this.ramData)),500))}))}readByte(e){return this.read(e,(e=>this.gameDataView.getUint8(e)),(e=>this.ramDataView.getUint8(e)))}readSignedByte(e){return this.read(e,(e=>this.gameDataView.getInt8(e)),(e=>this.ramDataView.getInt8(e)))}readWord(e){return this.read(e,(e=>this.gameDataView.getUint16(e,!0)),(e=>this.ramDataView.getUint16(e,!0)))}read(e,t,r){const i=16383&e;if(e>=0&&e<=16383)return t(e);if(e>=16384&&e<=32767)return t((this.romBank<<14)+i&this.romSize-1);if(!this.isRamAndRtcEnabled)return 255;if(this.ramBankOrRtcSelection<=3){const t=8191&e;return r((this.ramBankOrRtcSelection<<13)+t)}}write(e,t,r){if(this.isRamAndTimerGate(e)){const e=10,r=15&t;this.isRamAndRtcEnabled=r===e}else if(this.isRomBank(e)){const e=127&t;this.romBank=0===e?1:e}else if(this.isRamBankNumberOrRtcRegisterSelect(e))this.ramBankOrRtcSelection=t;else if(this.isLatchClockData(e))console.log("not implemented");else if(this.isRamBankOrRtcRegister(e)){const i=8191&e;this.ramBankOrRtcSelection<=3&&r((this.ramBankOrRtcSelection<<13)+i,t)}}isRamAndTimerGate(e){return e>=0&&e<=8191}isRomBank(e){return e>=8192&&e<=16383}isRamBankNumberOrRtcRegisterSelect(e){return e>=16384&&e<=24575}isLatchClockData(e){return e>=24576&&e<=32767}isRamBankOrRtcRegister(e){return e>=40960&&e<=49151}}t.Mbc3Cartridge=n},9145:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CPU=void 0;const i=r(2710),s=r(8254),n=r(7294),a=r(5494),o=r(1456),u=r(9879),l=r(927),c=r(8543),g=r(9099),d=r(9259),h=r(5449),y=r(7300),m=r(3739),f=r(9904),p=r(5425),v=r(9080),C=r(6584),R=r(4002),b=r(3120);class B{constructor(){this.isInterruptMasterEnable=!0,this.operationMap=new Map,this.cbSubOperationMap=new Map,this.createInputOutputOperations=f.createInputOutputOperations,this.createArithmeticOperations=m.createArithmeticOperations,this.createLogicalOperations=y.createLogicalOperations,this.createRotateShiftOperations=u.createRotateShiftOperations,this.createJumpOperations=o.createJumpOperations,this.createGeneralPurposeOperations=l.createGeneralPurposeOperations,this.createCallAndReturnOperations=n.createCallAndReturnOperations,this.createInterruptOperations=a.createInterruptOperations,this.createCbSubOperations=h.createCbSubOperations,this.timerCycles=0,this.frequencyCounter=0,this.cycleMultiplier=4,this.isHalted=!1,this.isStopped=!1,this.registers=new i.CpuRegisterCollection,this.createInputOutputOperations(),this.createArithmeticOperations(),this.createLogicalOperations(),this.createRotateShiftOperations(),this.createJumpOperations(),this.createGeneralPurposeOperations(),this.createCallAndReturnOperations(),this.createInterruptOperations(),this.createCbSubOperations(),this.initialize()}initialize(){this.registers.programCounter.value=d.Cartridge.EntryPointOffset,this.registers.stackPointer.value=65534,this.registers.HL.value=333,this.registers.C.value=19,this.registers.E.value=216,this.registers.A.value=1,this.registers.F.value=176}tick(){if(this.handleInterrupts(),this.isHalted)return this.updateTimers(1),1;const e=this.getOperation();return e.execute(),this.updateTimers(e.cycleTime),e.cycleTime}reset(){this.registers.reset()}halt(){this.isHalted=!0}stop(){this.isStopped=!0}pushToStack(e){this.registers.stackPointer.value-=2,s.memory.writeWord(this.registers.stackPointer.value,e)}popFromStack(){const e=s.memory.readWord(this.registers.stackPointer.value);return this.registers.stackPointer.value+=2,e}getOperation(){const e=s.memory.readByte(this.registers.programCounter.value);this.registers.programCounter.value++;const t=this.operationMap.get(e);if(!t){const t=e.toString(16),r=this.registers.programCounter.value.toString(16);throw new Error(`Operation ${t} at location ${r} not found.`)}return t}handleInterrupts(){const e=c.interruptRequestRegister.value&g.interruptEnableRegister.value;if(e>0&&(this.isHalted=!1),!this.isInterruptMasterEnable||0===e)return;this.pushToStack(this.registers.programCounter.value);const t=c.interruptRequestRegister.getInterruptFlags(e);t.isVerticalBlanking?(c.interruptRequestRegister.clearVBlankInterruptRequest(),this.registers.programCounter.value=B.VBlankInterruptAddress):t.isLCDStatus?(c.interruptRequestRegister.clearLcdStatusInterruptRequest(),this.registers.programCounter.value=B.LCDStatusInterruptAddress):t.isTimerOverflow?(c.interruptRequestRegister.clearTimerOverflowInterruptRequest(),this.registers.programCounter.value=B.TimerOverflowInterruptAddress):t.isSerialTransferCompletion?(c.interruptRequestRegister.clearSerialTransferInterruptRequest(),this.registers.programCounter.value=B.SerialTransferCompletionInterruptAddress):t.isP10P13NegativeEdge&&(c.interruptRequestRegister.clearP10P13NegativeEdgeInterruptRequest(),this.registers.programCounter.value=B.P10P13InputSignalLowInterruptAddress),this.isInterruptMasterEnable=!1}updateTimers(e){this.frequencyCounter=p.asUint16(this.frequencyCounter+e*this.cycleMultiplier),v.dividerRegister.setValueFromCpuDivider(p.getMostSignificantByte(this.frequencyCounter)),C.timerControllerRegister.isTimerOn&&(this.timerCycles+=e,this.timerCycles>=C.timerControllerRegister.cyclesForTimerUpdate&&(R.timerCounterRegister.value+1>255&&(c.interruptRequestRegister.triggerTimerInterruptRequest(),R.timerCounterRegister.value=b.timerModuloRegister.value),R.timerCounterRegister.value++,this.timerCycles=0))}addOperation(e){if(this.operationMap.has(e.byteDefinition))throw new Error(`Operation ${e.byteDefinition.toString(2)} has already been defined`);this.operationMap.set(e.byteDefinition,e)}addCbOperation(e){if(this.cbSubOperationMap.has(e.byteDefinition))throw new Error(`Operation ${e.byteDefinition.toString(2)} has already been defined`);this.cbSubOperationMap.set(e.byteDefinition,e)}}t.CPU=B,B.OperatingHertz=4194304,B.VBlankInterruptAddress=64,B.LCDStatusInterruptAddress=72,B.TimerOverflowInterruptAddress=80,B.SerialTransferCompletionInterruptAddress=88,B.P10P13InputSignalLowInterruptAddress=96},8025:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CpuFlagRegisterPair=void 0;const i=r(3115);class s extends i.CpuRegister{get value(){return this.dataView.getUint16(this.offset,!0)}set value(e){this.dataView.setUint16(this.offset,65520&e,!0)}}t.CpuFlagRegisterPair=s},9754:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CpuFlagRegister=void 0;const i=r(3115);class s extends i.CpuRegister{get Z(){return this.value>>7}set Z(e){1===e?this.value|=128:this.value&=-129}get isResultZero(){return 1===this.Z}set isResultZero(e){this.Z=e?1:0}get N(){return this.value>>6&1}set N(e){1===e?this.value|=64:this.value&=-65}get isSubtraction(){return 1===this.N}set isSubtraction(e){this.N=e?1:0}get H(){return this.value>>5&1}set H(e){1===e?this.value|=32:this.value&=-33}get isHalfCarry(){return 1===this.H}set isHalfCarry(e){this.H=e?1:0}get CY(){return this.value>>4&1}set CY(e){1===e?this.value|=16:this.value&=-17}get isCarry(){return 1===this.CY}set isCarry(e){this.CY=e?1:0}}t.CpuFlagRegister=s},2710:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CpuRegisterCollection=void 0;const i=r(3115),s=r(9754),n=r(8025);t.CpuRegisterCollection=class{constructor(){this.registersBuffer=new ArrayBuffer(12),this.registersView=new DataView(this.registersBuffer),this.F=new s.CpuFlagRegister("F",0,this.registersBuffer,-1),this.A=new i.CpuRegister("A",1,this.registersBuffer,i.CpuRegister.Code.A),this.C=new i.CpuRegister("C",2,this.registersBuffer,i.CpuRegister.Code.C),this.B=new i.CpuRegister("B",3,this.registersBuffer,i.CpuRegister.Code.B),this.E=new i.CpuRegister("E",4,this.registersBuffer,i.CpuRegister.Code.E),this.D=new i.CpuRegister("D",5,this.registersBuffer,i.CpuRegister.Code.D),this.L=new i.CpuRegister("L",6,this.registersBuffer,i.CpuRegister.Code.L),this.H=new i.CpuRegister("H",7,this.registersBuffer,i.CpuRegister.Code.H),this.AF=new n.CpuFlagRegisterPair("AF",0,this.registersBuffer,i.CpuRegister.PairCode.AF,2),this.BC=new i.CpuRegister("BC",2,this.registersBuffer,i.CpuRegister.PairCode.BC,2),this.DE=new i.CpuRegister("DE",4,this.registersBuffer,i.CpuRegister.PairCode.DE,2),this.HL=new i.CpuRegister("HL",6,this.registersBuffer,i.CpuRegister.PairCode.HL,2),this.programCounter=new i.CpuRegister("PC",8,this.registersBuffer,-1,2),this.stackPointer=new i.CpuRegister("SP",10,this.registersBuffer,i.CpuRegister.PairCode.SP,2),this.baseRegisters=[this.A,this.B,this.C,this.D,this.E,this.H,this.L],this.registerPairs=[this.AF,this.BC,this.DE,this.HL,this.stackPointer]}get flags(){return this.F}reset(){this.registersBuffer=new ArrayBuffer(12),this.registersView=new DataView(this.registersBuffer)}}},3115:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CpuRegister=void 0;class r{constructor(e,t,r,i,s=1){this.name=e,this.offset=t,this.dataView=new DataView(r),this.code=i,this.byteSize=s}get value(){return 1===this.byteSize?this.dataView.getUint8(this.offset):this.dataView.getUint16(this.offset,!0)}set value(e){1===this.byteSize?this.dataView.setUint8(this.offset,e):this.dataView.setUint16(this.offset,e,!0)}}t.CpuRegister=r,function(e){let t,r;!function(e){e[e.A=7]="A",e[e.B=0]="B",e[e.C=1]="C",e[e.D=2]="D",e[e.E=3]="E",e[e.H=4]="H",e[e.L=5]="L"}(t=e.Code||(e.Code={})),function(e){e[e.BC=0]="BC",e[e.DE=1]="DE",e[e.HL=2]="HL",e[e.AF=3]="AF",e[e.SP=3]="SP"}(r=e.PairCode||(e.PairCode={}))}(r=t.CpuRegister||(t.CpuRegister={}))},4114:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBitSubOperations=void 0;const i=r(5425),s=r(8254);t.getBitSubOperations=function(e){const{registers:t}=e;function r(e,r){const s=i.getBit(e,r);t.flags.isResultZero=!s,t.flags.isHalfCarry=!0,t.flags.isSubtraction=!1}function n(e,t){return 64+(e<<3)+t}function a(e){return 64+(e<<3)+6}e.registers.baseRegisters.forEach((t=>{for(let i=0;i<8;i++)e.addCbOperation({byteDefinition:n(i,t.code),instruction:`BIT ${i}, ${t.name}`,cycleTime:2,byteLength:2,execute(){r(t.value,i)}})}));for(let i=0;i<8;i++)e.addCbOperation({byteDefinition:a(i),instruction:`BIT ${i}, (HL)`,cycleTime:3,byteLength:2,execute(){r(s.memory.readByte(t.HL.value),i)}})}},5449:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCbSubOperations=void 0;const i=r(9801),s=r(4114),n=r(6782),a=r(2238),o=r(8254);t.createCbSubOperations=function(){const e=this;this.addOperation({instruction:"",byteDefinition:203,cycleTime:0,byteLength:0,execute(){const t=o.memory.readByte(e.registers.programCounter.value);e.registers.programCounter.value++,e.cbSubOperationMap.get(t).execute()}}),i.getRotateShiftSubOperations(e),s.getBitSubOperations(e),n.getSetSubOperations(e),a.getResSubOperations(e)}},2238:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getResSubOperations=void 0;const i=r(5425),s=r(8254);t.getResSubOperations=function(e){const{registers:t}=e;function r(e,t){return 128+(e<<3)+t}function n(e){return 128+(e<<3)+6}e.registers.baseRegisters.forEach((t=>{for(let s=0;s<8;s++)e.addCbOperation({byteDefinition:r(s,t.code),instruction:`RES ${s}, ${t.name}`,cycleTime:2,byteLength:2,execute(){t.value=i.clearBit(t.value,s)}})}));for(let r=0;r<8;r++)e.addCbOperation({byteDefinition:n(r),instruction:`RES ${r}, (HL)`,cycleTime:3,byteLength:2,execute(){const e=s.memory.readByte(t.HL.value),n=i.clearBit(e,r);s.memory.writeByte(t.HL.value,n)}})}},9801:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRotateShiftSubOperations=void 0;const i=r(8254),s=r(5425);t.getRotateShiftSubOperations=function(e){const{registers:t}=e;function r(e){const r=((15&e)<<4)+(e>>4);return t.flags.isResultZero=0===r,t.flags.isSubtraction=!1,t.flags.isHalfCarry=!1,t.flags.isCarry=!1,r}e.registers.baseRegisters.forEach((t=>{var i;e.addCbOperation({byteDefinition:(i=t.code,48+i),instruction:`SWAP ${t.name}`,cycleTime:2,byteLength:2,execute(){t.value=r(t.value)}})})),e.addCbOperation({byteDefinition:54,instruction:"SWAP (HL)",cycleTime:4,byteLength:2,execute(){const e=i.memory.readByte(t.HL.value);i.memory.writeByte(t.HL.value,r(e))}}),t.baseRegisters.forEach((r=>{var i;e.addCbOperation({byteDefinition:(i=r.code,0+i),instruction:`RLC ${r.name}`,cycleTime:2,byteLength:2,execute(){const e=r.value>>7;r.value=(r.value<<1)+e,t.flags.CY=e,t.flags.isHalfCarry=!1,t.flags.isResultZero=0===r.value,t.flags.isSubtraction=!1}})})),e.addCbOperation({byteDefinition:6,instruction:"RLC (HL)",cycleTime:4,byteLength:2,execute(){const e=i.memory.readByte(t.HL.value),r=e>>7,s=255&(e<<1&255)+r;i.memory.writeByte(t.HL.value,s),t.flags.CY=r,t.flags.isHalfCarry=!1,t.flags.isResultZero=0===s,t.flags.isSubtraction=!1}}),t.baseRegisters.forEach((r=>{var i;e.addCbOperation({instruction:`RL ${r.name}`,byteDefinition:(i=r.code,16+i),cycleTime:2,byteLength:2,execute(){const e=r.value>>7,i=255&(r.value<<1&255)+t.flags.CY;t.flags.CY=e,t.flags.isResultZero=0===i,t.flags.H=0,t.flags.N=0,r.value=i}})})),e.addCbOperation({instruction:"RL (HL)",byteDefinition:22,cycleTime:4,byteLength:2,execute(){const e=i.memory.readByte(t.HL.value),r=e>>7,s=255&(e<<1&255)+t.flags.CY;t.flags.CY=r,t.flags.H=0,t.flags.N=0,t.flags.isResultZero=0===s,i.memory.writeByte(t.HL.value,s)}}),t.baseRegisters.forEach((r=>{var i;e.addCbOperation({instruction:`RRC ${r.name}`,byteDefinition:(i=r.code,8+i),cycleTime:2,byteLength:2,execute(){const e=1&r.value,i=(r.value>>1&255)+(e<<7);t.flags.CY=e,t.flags.H=0,t.flags.isResultZero=0===i,t.flags.N=0,r.value=i}})})),e.addCbOperation({instruction:"RRC (HL)",byteDefinition:14,cycleTime:4,byteLength:2,execute(){const e=i.memory.readByte(t.HL.value),r=1&e,s=(e>>1&255)+(r<<7);t.flags.CY=r,t.flags.H=0,t.flags.isResultZero=0===s,t.flags.N=0,i.memory.writeByte(t.HL.value,s)}}),t.baseRegisters.forEach((r=>{var i;e.addCbOperation({instruction:`RR ${r.name}`,byteDefinition:(i=r.code,24+i),cycleTime:2,byteLength:2,execute(){const e=1&r.value,i=(r.value>>1&255)+(t.flags.CY<<7);t.flags.isResultZero=0===i,t.flags.CY=e,t.flags.H=0,t.flags.N=0,r.value=i}})})),e.addCbOperation({instruction:"RR (HL)",byteDefinition:30,cycleTime:4,byteLength:2,execute(){const e=i.memory.readByte(t.HL.value),r=1&e,s=(e>>1&255)+(t.flags.CY<<7);t.flags.isResultZero=0===s,t.flags.CY=r,t.flags.H=0,t.flags.N=0,i.memory.writeByte(t.HL.value,s)}}),t.baseRegisters.forEach((r=>{var i;e.addCbOperation({instruction:`SLA ${r.name}`,byteDefinition:(i=r.code,32+i),cycleTime:2,byteLength:2,execute(){const e=r.value>>7,i=r.value<<1&255;t.flags.isResultZero=0===i,t.flags.CY=e,t.flags.H=0,t.flags.N=0,r.value=i}})})),e.addCbOperation({instruction:"SLA (HL)",byteDefinition:38,cycleTime:4,byteLength:2,execute(){const e=i.memory.readByte(t.HL.value),r=e>>7,s=e<<1&255;t.flags.isResultZero=0===s,t.flags.CY=r,t.flags.H=0,t.flags.N=0,i.memory.writeByte(t.HL.value,s)}}),t.baseRegisters.forEach((r=>{var i;e.addCbOperation({instruction:`SRA ${r.name}`,byteDefinition:(i=r.code,40+i),cycleTime:2,byteLength:2,execute(){const e=1&r.value,i=r.value>>7,n=r.value>>1&255,a=s.setBit(n,7,i);t.flags.isResultZero=0===a,t.flags.CY=e,t.flags.H=0,t.flags.N=0,r.value=a}})})),e.addCbOperation({instruction:"SRA (HL)",byteDefinition:46,cycleTime:4,byteLength:2,execute(){const e=i.memory.readByte(t.HL.value),r=1&e,n=e>>7,a=e>>1&255,o=s.setBit(a,7,n);t.flags.isResultZero=0===o,t.flags.CY=r,t.flags.H=0,t.flags.N=0,i.memory.writeByte(t.HL.value,o)}}),t.baseRegisters.forEach((r=>{var i;e.addCbOperation({instruction:`SRL ${r.name}`,byteDefinition:(i=r.code,56+i),cycleTime:2,byteLength:2,execute(){const e=1&r.value,i=r.value>>1&255;t.flags.isResultZero=0===i,t.flags.CY=e,t.flags.H=0,t.flags.N=0,r.value=i}})})),e.addCbOperation({instruction:"SRL (HL)",byteDefinition:62,cycleTime:4,byteLength:2,execute(){const e=i.memory.readByte(t.HL.value),r=1&e,s=e>>1&255;t.flags.isResultZero=0===s,t.flags.CY=r,t.flags.H=0,t.flags.N=0,i.memory.writeByte(t.HL.value,s)}})}},6782:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSetSubOperations=void 0;const i=r(5425),s=r(8254);t.getSetSubOperations=function(e){const{registers:t}=e;function r(e,t){return 192+(e<<3)+t}function n(e){return 192+(e<<3)+6}e.registers.baseRegisters.forEach((t=>{for(let s=0;s<8;s++)e.addCbOperation({byteDefinition:r(s,t.code),instruction:`SET ${s}, ${t.name}`,cycleTime:2,byteLength:2,execute(){t.value=i.setBit(t.value,s,1)}})}));for(let r=0;r<8;r++)e.addCbOperation({byteDefinition:n(r),instruction:`SET ${r}, (HL)`,cycleTime:3,byteLength:2,execute(){const e=s.memory.readByte(t.HL.value),n=i.setBit(e,r,1);s.memory.writeByte(t.HL.value,n)}})}},3739:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createArithmeticOperations=void 0;const i=r(8254);t.createArithmeticOperations=function(){const{registers:e}=this;function t(t,r){const i=t+r&255;return e.flags.isResultZero=0===i,e.flags.isHalfCarry=(15&i)<(15&t),e.flags.isSubtraction=!1,e.flags.isCarry=i<t,i}function r(t,r,i){const s=t+r+i&255;return e.flags.isResultZero=0===s,e.flags.isHalfCarry=(15&t)+(15&r)+i>15,e.flags.isSubtraction=!1,e.flags.isCarry=s<t+i,s}function s(t){const r=t-1&255;return e.flags.isResultZero=0===r,e.flags.isHalfCarry=(15&r)>(15&t),e.flags.isSubtraction=!0,r}function n(t){const r=t+1&255;return e.flags.isHalfCarry=(15&r)<(15&t),e.flags.isSubtraction=!1,e.flags.isResultZero=0===r,r}function a(t,r){const i=t-r&255;return e.flags.isResultZero=0===i,e.flags.isSubtraction=!0,e.flags.isHalfCarry=(15&i)>(15&t),e.flags.isCarry=i>t,i}function o(t,r,i){const s=t-r-i&255;return e.flags.isResultZero=0===s,e.flags.isHalfCarry=(15&t)-(15&r)-i<0,e.flags.isSubtraction=!0,e.flags.isCarry=s>t-i,s}this.registers.baseRegisters.forEach((r=>{var i;this.addOperation({byteDefinition:(i=r.code,128+i),cycleTime:1,byteLength:1,get instruction(){return`ADD A, ${r.name}`},execute(){e.A.value=t(e.A.value,r.value)}})})),this.addOperation({byteDefinition:198,cycleTime:2,byteLength:2,get instruction(){return`ADD A, 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},execute(){const r=i.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=t(e.A.value,r)}}),this.addOperation({byteDefinition:134,cycleTime:2,byteLength:1,instruction:"ADD A, (HL)",execute(){const r=i.memory.readByte(e.HL.value);e.A.value=t(e.A.value,r)}}),this.registers.baseRegisters.forEach((t=>{var i;this.addOperation({byteDefinition:(i=t.code,136+i),instruction:`ADC A, ${t.name}`,cycleTime:1,byteLength:1,execute(){e.A.value=r(e.A.value,t.value,255&e.flags.CY)}})})),this.addOperation({byteDefinition:206,cycleTime:2,byteLength:2,get instruction(){return`ADC A, 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},execute(){const t=i.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=r(e.A.value,t,e.flags.CY)}}),this.addOperation({byteDefinition:142,cycleTime:2,byteLength:1,instruction:"ADC A, (HL)",execute(){const t=i.memory.readByte(e.HL.value);e.A.value=r(e.A.value,t,e.flags.CY)}}),e.registerPairs.filter((e=>"AF"!==e.name)).forEach((t=>{var r;this.addOperation({instruction:`ADD HL, ${t.name}`,byteDefinition:(r=t.code,9+(r<<4)),cycleTime:2,byteLength:1,execute(){e.HL.value=function(t,r){const i=t+r&65535;return e.flags.isHalfCarry=(4095&i)<(4095&t),e.flags.isSubtraction=!1,e.flags.isCarry=i<t,i}(e.HL.value,t.value)}})})),this.addOperation({byteDefinition:232,cycleTime:4,byteLength:2,get instruction(){const t=i.memory.readSignedByte(e.programCounter.value);return t>=0?`ADD SP, 0x${t.toString(16)}`:`ADD SP, -0x${(-1*t).toString(16)}`},execute(){const t=i.memory.readSignedByte(e.programCounter.value);e.programCounter.value++;const r=15-(15&e.stackPointer.value),s=255-(255&e.stackPointer.value);e.flags.isHalfCarry=(15&t)>r,e.flags.isCarry=(255&t)>s,e.flags.isResultZero=!1,e.flags.isSubtraction=!1,e.stackPointer.value=e.stackPointer.value+t}}),this.registers.baseRegisters.forEach((e=>{var t;this.addOperation({instruction:`DEC ${e.name}`,byteDefinition:(t=e.code,5+(t<<3)),cycleTime:1,byteLength:1,execute(){e.value=s(e.value)}})})),this.addOperation({instruction:"DEC (HL)",byteDefinition:53,cycleTime:3,byteLength:1,execute(){const t=s(i.memory.readByte(e.HL.value));i.memory.writeByte(e.HL.value,t)}}),e.registerPairs.filter((e=>"AF"!==e.name)).forEach((e=>{var t;this.addOperation({instruction:`DEC ${e.name}`,byteDefinition:(t=e.code,11+(t<<4)),cycleTime:2,byteLength:1,execute(){e.value--}})})),this.registers.baseRegisters.forEach((e=>{var t;this.addOperation({byteDefinition:(t=e.code,4+(t<<3)),cycleTime:1,byteLength:1,instruction:`INC ${e.name}`,execute(){e.value=n(e.value)}})})),this.addOperation({byteDefinition:52,cycleTime:3,byteLength:1,instruction:"INC (HL)",execute(){const t=n(i.memory.readByte(e.HL.value));i.memory.writeByte(e.HL.value,t)}}),e.registerPairs.filter((e=>"AF"!==e.name)).forEach((e=>{var t;this.addOperation({byteDefinition:(t=e.code,3+(t<<4)),cycleTime:2,byteLength:1,instruction:`INC ${e.name}`,execute(){e.value++}})})),this.registers.baseRegisters.forEach((t=>{var r;this.addOperation({byteDefinition:(r=t.code,144+r),cycleTime:1,byteLength:1,instruction:`SUB ${t.name}`,execute(){e.A.value=a(e.A.value,t.value)}})})),this.addOperation({byteDefinition:214,cycleTime:2,byteLength:2,get instruction(){return`SUB 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},execute(){const t=i.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=a(e.A.value,t)}}),this.addOperation({byteDefinition:150,cycleTime:2,byteLength:1,instruction:"SUB (HL)",execute(){const t=i.memory.readByte(e.HL.value);e.A.value=a(e.A.value,t)}}),this.registers.baseRegisters.forEach((t=>{var r;this.addOperation({byteDefinition:(r=t.code,152+r),cycleTime:1,byteLength:1,instruction:`SBC A, ${t.name}`,execute(){e.A.value=o(e.A.value,t.value,e.flags.CY)}})})),this.addOperation({get instruction(){return`SBC 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},byteDefinition:222,cycleTime:2,byteLength:2,execute(){const t=i.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=o(e.A.value,t,e.flags.CY)}}),this.addOperation({instruction:"SBC A, (HL)",byteDefinition:158,cycleTime:2,byteLength:1,execute(){const t=i.memory.readByte(e.HL.value);e.A.value=o(e.A.value,t,e.flags.CY)}})}},7294:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCallAndReturnOperations=void 0;const i=r(8254);var s;!function(e){e[e.NZ=0]="NZ",e[e.Z=1]="Z",e[e.NC=2]="NC",e[e.C=3]="C"}(s||(s={})),t.createCallAndReturnOperations=function(){const{registers:e}=this,t=this;function r(e){return 192+(e<<3)+4}function n(e){return 192+(e<<3)}function a(e){return 192+(e<<3)+7}this.addOperation({get instruction(){return`CALL 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:205,byteLength:3,cycleTime:6,execute(){const r=i.memory.readWord(e.programCounter.value);e.programCounter.value+=2;const s=e.programCounter.value;t.pushToStack(s),e.programCounter.value=r}}),this.addOperation({get instruction(){return`CALL NZ, 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:r(s.NZ),byteLength:3,get cycleTime(){return e.flags.isResultZero?3:6},execute(){if(e.flags.isResultZero)e.programCounter.value+=2;else{const r=i.memory.readWord(e.programCounter.value);e.programCounter.value+=2;const s=e.programCounter.value;t.pushToStack(s),e.programCounter.value=r}}}),this.addOperation({get instruction(){return`CALL Z, 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:r(s.Z),byteLength:3,get cycleTime(){return e.flags.isResultZero?6:3},execute(){if(e.flags.isResultZero){const r=i.memory.readWord(e.programCounter.value);e.programCounter.value+=2;const s=e.programCounter.value;t.pushToStack(s),e.programCounter.value=r}else e.programCounter.value+=2}}),this.addOperation({get instruction(){return`CALL NC, 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:r(s.NC),byteLength:3,get cycleTime(){return e.flags.isCarry?3:6},execute(){if(e.flags.isCarry)e.programCounter.value+=2;else{const r=i.memory.readWord(e.programCounter.value);e.programCounter.value+=2;const s=e.programCounter.value;t.pushToStack(s),e.programCounter.value=r}}}),this.addOperation({get instruction(){return`CALL C, 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:r(s.C),byteLength:3,get cycleTime(){return e.flags.isCarry?6:3},execute(){if(e.flags.isCarry){const r=i.memory.readWord(e.programCounter.value);e.programCounter.value+=2;const s=e.programCounter.value;t.pushToStack(s),e.programCounter.value=r}else e.programCounter.value+=2}}),this.addOperation({instruction:"RET",byteDefinition:201,byteLength:1,cycleTime:4,execute(){e.programCounter.value=t.popFromStack()}}),this.addOperation({instruction:"RETI",byteDefinition:217,byteLength:1,cycleTime:4,execute(){e.programCounter.value=t.popFromStack(),t.isInterruptMasterEnable=!0}}),this.addOperation({instruction:"RET NZ",byteDefinition:n(s.NZ),byteLength:1,get cycleTime(){return e.flags.isResultZero?2:5},execute(){e.flags.isResultZero||(e.programCounter.value=t.popFromStack())}}),this.addOperation({instruction:"RET Z",byteDefinition:n(s.Z),byteLength:1,get cycleTime(){return e.flags.isResultZero?5:2},execute(){e.flags.isResultZero&&(e.programCounter.value=t.popFromStack())}}),this.addOperation({instruction:"RET NC",byteDefinition:n(s.NC),byteLength:1,get cycleTime(){return e.flags.isCarry?2:5},execute(){e.flags.isCarry||(e.programCounter.value=t.popFromStack())}}),this.addOperation({instruction:"RET C",byteDefinition:n(s.C),byteLength:1,get cycleTime(){return e.flags.isCarry?5:2},execute(){e.flags.isCarry&&(e.programCounter.value=t.popFromStack())}});const o=[0,8,16,24,32,40,48,56];for(let r=0;r<8;r++)this.addOperation({byteDefinition:a(r),instruction:`RST ${r}`,byteLength:1,cycleTime:4,execute(){t.pushToStack(e.programCounter.value),e.programCounter.value=o[r]}})}},927:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createGeneralPurposeOperations=void 0,t.createGeneralPurposeOperations=function(){const{registers:e}=this;this.addOperation({instruction:"DAA",byteDefinition:39,cycleTime:1,byteLength:1,execute(){const{A:t,flags:r}=e,i=r.isSubtraction?-6:6,s=r.isSubtraction?-96:96,n=!r.isSubtraction&&(15&t.value)>9,a=!r.isSubtraction&&t.value>153;(r.isHalfCarry||n)&&(t.value+=i),(r.isCarry||a)&&(t.value+=s,r.isCarry=!0),r.isResultZero=0===t.value,r.isHalfCarry=!1}}),this.addOperation({instruction:"CPL",byteDefinition:47,cycleTime:1,byteLength:1,execute(){e.A.value=~e.A.value,e.flags.isHalfCarry=!0,e.flags.isSubtraction=!0}}),this.addOperation({instruction:"NOP",byteDefinition:0,cycleTime:1,byteLength:1,execute(){}}),this.addOperation({instruction:"CCF",byteDefinition:63,cycleTime:1,byteLength:1,execute(){e.flags.isSubtraction=!1,e.flags.isHalfCarry=!1,e.flags.isCarry=!e.flags.isCarry}}),this.addOperation({instruction:"SCF",byteDefinition:55,cycleTime:1,byteLength:1,execute(){e.flags.isSubtraction=!1,e.flags.isHalfCarry=!1,e.flags.isCarry=!0}}),this.addOperation({instruction:"HALT",byteDefinition:118,cycleTime:1,byteLength:1,execute:()=>{this.halt()}}),this.addOperation({instruction:"STOP",byteDefinition:16,cycleTime:1,byteLength:1,execute:()=>{this.stop()}})}},9904:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createInputOutputOperations=void 0;const i=r(8254);t.createInputOutputOperations=function(){const{registers:e}=this;this.registers.baseRegisters.forEach((t=>{var r;this.addOperation({byteDefinition:(r=t.code,64+(r<<3)+6),instruction:`LD ${t.name}, (HL)`,cycleTime:2,byteLength:1,execute(){t.value=i.memory.readByte(e.HL.value)}})})),this.addOperation({instruction:"LD A, (BC)",byteDefinition:10,cycleTime:2,byteLength:1,execute(){e.A.value=i.memory.readByte(e.BC.value)}}),this.addOperation({instruction:"LD A, (DE)",byteDefinition:26,cycleTime:2,byteLength:1,execute(){e.A.value=i.memory.readByte(e.DE.value)}}),this.addOperation({instruction:"LD A, (C)",byteDefinition:242,cycleTime:2,byteLength:1,execute(){e.A.value=i.memory.readByte(65280+e.C.value)}}),this.addOperation({get instruction(){return`LD A, (0x${i.memory.readByte(e.programCounter.value).toString(16)})`},byteDefinition:240,cycleTime:3,byteLength:2,execute(){const t=i.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=i.memory.readByte(65280+t)}}),this.addOperation({get instruction(){return`LD A, (0x${i.memory.readWord(e.programCounter.value).toString(16)})`},byteDefinition:250,cycleTime:4,byteLength:3,execute(){const t=i.memory.readWord(e.programCounter.value);e.programCounter.value+=2,e.A.value=i.memory.readByte(t)}}),this.addOperation({instruction:"LD A, (HLI)",byteDefinition:42,cycleTime:2,byteLength:1,execute(){e.A.value=i.memory.readByte(e.HL.value),e.HL.value++}}),this.addOperation({instruction:"LD A, (HLD)",byteDefinition:58,cycleTime:2,byteLength:1,execute(){e.A.value=i.memory.readByte(e.HL.value),e.HL.value--}}),this.registers.baseRegisters.forEach((t=>{var r;this.addOperation({byteDefinition:(r=t.code,112+r),instruction:`LD (HL), ${t.name}`,cycleTime:2,byteLength:1,execute(){i.memory.writeByte(e.HL.value,t.value)}})})),this.addOperation({instruction:"LD (C), A",byteDefinition:226,cycleTime:2,byteLength:1,execute(){i.memory.writeByte(65280+e.C.value,e.A.value)}}),this.addOperation({get instruction(){return`LD (0x${i.memory.readByte(e.programCounter.value).toString(16)}), A`},byteDefinition:224,cycleTime:3,byteLength:2,execute(){const t=i.memory.readByte(e.programCounter.value);e.programCounter.value++,i.memory.writeByte(65280+t,e.A.value)}}),this.addOperation({get instruction(){return`LD (0x${i.memory.readWord(e.programCounter.value).toString(16)}), A`},byteDefinition:234,cycleTime:4,byteLength:3,execute(){const t=i.memory.readWord(e.programCounter.value);e.programCounter.value+=2,i.memory.writeByte(t,e.A.value)}}),this.addOperation({instruction:"LD (BC), A",byteDefinition:2,cycleTime:2,byteLength:1,execute(){i.memory.writeByte(e.BC.value,e.A.value)}}),this.addOperation({instruction:"LD (DE), A",byteDefinition:18,cycleTime:2,byteLength:1,execute(){i.memory.writeByte(e.DE.value,e.A.value)}}),this.addOperation({instruction:"LD (HLI), A",byteDefinition:34,cycleTime:2,byteLength:1,execute(){i.memory.writeByte(e.HL.value,e.A.value),e.HL.value=e.HL.value+1}}),this.addOperation({instruction:"LD (HLD), A",byteDefinition:50,cycleTime:2,byteLength:1,execute(){i.memory.writeByte(e.HL.value,e.A.value),e.HL.value=e.HL.value-1}}),e.baseRegisters.forEach((t=>{e.baseRegisters.forEach((e=>{var r,i;this.addOperation({byteDefinition:(r=t.code,i=e.code,64+(r<<3)+i),instruction:`LD ${t.name}, ${e.name}`,byteLength:1,cycleTime:2,execute(){t.value=e.value}})}))})),this.addOperation({get instruction(){return`LD (HL), 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},byteDefinition:54,cycleTime:3,byteLength:2,execute(){const t=i.memory.readByte(e.programCounter.value);e.programCounter.value++,i.memory.writeByte(e.HL.value,t)}}),this.registers.baseRegisters.forEach((t=>{var r;this.addOperation({get instruction(){return`LD ${t.name}, 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},byteDefinition:(r=t.code,6+(r<<3)),cycleTime:2,byteLength:2,execute(){t.value=i.memory.readByte(e.programCounter.value),e.programCounter.value++}})})),this.addOperation({get instruction(){return`LD (0x${i.memory.readWord(e.programCounter.value).toString(16)}), SP`},byteDefinition:8,cycleTime:5,byteLength:3,execute(){const t=i.memory.readWord(e.programCounter.value);i.memory.writeWord(t,e.stackPointer.value),e.programCounter.value+=2}}),e.registerPairs.filter((e=>"AF"!==e.name)).forEach((t=>{var r;this.addOperation({get instruction(){return`LD ${t.name}, 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:(r=t.code,1+(r<<4)),cycleTime:3,byteLength:3,execute(){t.value=i.memory.readWord(e.programCounter.value),e.programCounter.value+=2}})})),this.addOperation({instruction:"LD SP, HL",byteDefinition:249,cycleTime:2,byteLength:1,execute(){e.stackPointer.value=e.HL.value}}),e.registerPairs.filter((e=>"SP"!==e.name)).forEach((e=>{var t;this.addOperation({instruction:`PUSH ${e.name}`,byteDefinition:(t=e.code,192+(t<<4)+5),byteLength:1,cycleTime:4,execute:()=>{this.pushToStack(e.value)}})})),e.registerPairs.filter((e=>"SP"!==e.name)).forEach((e=>{var t;this.addOperation({instruction:`POP ${e.name}`,byteDefinition:(t=e.code,192+(t<<4)+1),byteLength:1,cycleTime:3,execute:()=>{e.value=this.popFromStack()}})})),this.addOperation({byteDefinition:248,get instruction(){const t=i.memory.readSignedByte(e.programCounter.value);return t>=0?`LDHL SP,  0x${t.toString(16)}`:`LDHL SP,  -0x${(-1*t).toString(16)}`},byteLength:2,cycleTime:3,execute(){const t=i.memory.readSignedByte(e.programCounter.value);e.programCounter.value++;const r=15-(15&e.stackPointer.value),s=255-(255&e.stackPointer.value);e.flags.isHalfCarry=(15&t)>r,e.flags.isCarry=(255&t)>s,e.flags.isResultZero=!1,e.flags.isSubtraction=!1,e.HL.value=e.stackPointer.value+t}})}},5494:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createInterruptOperations=void 0,t.createInterruptOperations=function(){const e=this;this.addOperation({instruction:"EI",byteDefinition:251,byteLength:1,cycleTime:1,execute(){e.isInterruptMasterEnable=!0}}),this.addOperation({instruction:"DI",byteDefinition:243,byteLength:1,cycleTime:1,execute(){e.isInterruptMasterEnable=!1}})}},1456:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createJumpOperations=void 0;const i=r(8254);t.createJumpOperations=function(){const{registers:e}=this;this.addOperation({get instruction(){return`JP 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:195,cycleTime:4,byteLength:3,execute(){e.programCounter.value=i.memory.readWord(e.programCounter.value)}}),this.addOperation({get instruction(){return`JP NZ, 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:194,get cycleTime(){return e.flags.isResultZero?3:4},byteLength:3,execute(){e.flags.isResultZero?e.programCounter.value+=2:e.programCounter.value=i.memory.readWord(e.programCounter.value)}}),this.addOperation({get instruction(){return`JP Z, 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:202,get cycleTime(){return e.flags.isResultZero?4:3},byteLength:3,execute(){e.flags.isResultZero?e.programCounter.value=i.memory.readWord(e.programCounter.value):e.programCounter.value+=2}}),this.addOperation({get instruction(){return`JP NC, 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:210,get cycleTime(){return e.flags.isCarry?3:4},byteLength:3,execute(){e.flags.isCarry?e.programCounter.value+=2:e.programCounter.value=i.memory.readWord(e.programCounter.value)}}),this.addOperation({get instruction(){return`JP C, 0x${i.memory.readWord(e.programCounter.value).toString(16)}`},byteDefinition:218,get cycleTime(){return e.flags.isCarry?4:3},byteLength:3,execute(){e.flags.isCarry?e.programCounter.value=i.memory.readWord(e.programCounter.value):e.programCounter.value+=2}}),this.addOperation({get instruction(){const t=i.memory.readSignedByte(e.programCounter.value);return t>=0?`JR 0x${t.toString(16)}`:`JR -0x${(-1*t).toString(16)}`},byteDefinition:24,cycleTime:3,byteLength:2,execute(){const t=i.memory.readSignedByte(e.programCounter.value);e.programCounter.value++,e.programCounter.value=e.programCounter.value+t}}),this.addOperation({get instruction(){const t=i.memory.readSignedByte(e.programCounter.value);return t>=0?`JR NZ 0x${t.toString(16)}`:`JR NZ -0x${(-1*t).toString(16)}`},byteDefinition:32,cycleTime:e.flags.isResultZero?2:3,byteLength:2,execute(){if(e.flags.isResultZero)e.programCounter.value++;else{const t=i.memory.readSignedByte(e.programCounter.value);e.programCounter.value++,e.programCounter.value=e.programCounter.value+t}}}),this.addOperation({get instruction(){const t=i.memory.readSignedByte(e.programCounter.value);return t>=0?`JR Z 0x${t.toString(16)}`:`JR Z -0x${(-1*t).toString(16)}`},byteDefinition:40,cycleTime:e.flags.isResultZero?3:2,byteLength:2,execute(){if(e.flags.isResultZero){const t=i.memory.readSignedByte(e.programCounter.value);e.programCounter.value++,e.programCounter.value=e.programCounter.value+t}else e.programCounter.value++}}),this.addOperation({get instruction(){const t=i.memory.readSignedByte(e.programCounter.value);return t>=0?`JR NC 0x${t.toString(16)}`:`JR NC -0x${(-1*t).toString(16)}`},byteDefinition:48,cycleTime:e.flags.isCarry?2:3,byteLength:2,execute(){if(e.flags.isCarry)e.programCounter.value++;else{const t=i.memory.readSignedByte(e.programCounter.value);e.programCounter.value++,e.programCounter.value=e.programCounter.value+t}}}),this.addOperation({get instruction(){const t=i.memory.readSignedByte(e.programCounter.value);return t>=0?`JR C 0x${t.toString(16)}`:`JR C -0x${(-1*t).toString(16)}`},byteDefinition:56,cycleTime:e.flags.isCarry?3:2,byteLength:2,execute(){if(e.flags.isCarry){const t=i.memory.readSignedByte(e.programCounter.value);e.programCounter.value++,e.programCounter.value=e.programCounter.value+t}else e.programCounter.value++}}),this.addOperation({instruction:" JP (HL)",byteDefinition:233,cycleTime:1,byteLength:1,execute(){e.programCounter.value=e.HL.value}})}},7300:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLogicalOperations=void 0;const i=r(8254);t.createLogicalOperations=function(){const{registers:e}=this;function t(t,r){const i=t&r&255;return e.flags.isCarry=!1,e.flags.isHalfCarry=!0,e.flags.isSubtraction=!1,e.flags.isResultZero=0===i,i}function r(t,r){const i=t-r&255;e.flags.isResultZero=0===i,e.flags.isHalfCarry=(15&t)<(15&r),e.flags.isSubtraction=!0,e.flags.isCarry=t<r}function s(t,r){const i=255&(t|r);return e.flags.isCarry=!1,e.flags.isHalfCarry=!1,e.flags.isSubtraction=!1,e.flags.isResultZero=0===i,i}function n(t,r){const i=255&(t^r);return e.flags.isCarry=!1,e.flags.isHalfCarry=!1,e.flags.isSubtraction=!1,e.flags.isResultZero=0===i,i}this.registers.baseRegisters.forEach((r=>{var i;this.addOperation({byteDefinition:(i=r.code,160+i),cycleTime:1,byteLength:1,instruction:`AND ${r.name}`,execute(){e.A.value=t(e.A.value,r.value)}})})),this.addOperation({byteDefinition:230,cycleTime:2,byteLength:2,get instruction(){return`AND 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},execute(){const r=i.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=t(e.A.value,r)}}),this.addOperation({byteDefinition:166,cycleTime:2,byteLength:1,get instruction(){return`AND 0x${i.memory.readByte(e.HL.value).toString(16)}`},execute(){const r=i.memory.readByte(e.HL.value);e.A.value=t(e.A.value,r)}}),this.registers.baseRegisters.forEach((t=>{var i;this.addOperation({instruction:`CP ${t.name}`,byteDefinition:(i=t.code,184+i),cycleTime:1,byteLength:1,execute(){r(e.A.value,t.value)}})})),this.addOperation({get instruction(){return`CP 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},byteDefinition:254,cycleTime:2,byteLength:2,execute(){const t=i.memory.readByte(e.programCounter.value);e.programCounter.value++,r(e.A.value,t)}}),this.addOperation({instruction:"CP (HL)",byteDefinition:190,cycleTime:2,byteLength:1,execute(){const t=i.memory.readByte(e.HL.value);r(e.A.value,t)}}),this.registers.baseRegisters.forEach((t=>{var r;this.addOperation({byteDefinition:(r=t.code,176+r),cycleTime:1,byteLength:1,instruction:`OR ${t.name}`,execute(){e.A.value=s(e.A.value,t.value)}})})),this.addOperation({byteDefinition:246,cycleTime:2,byteLength:2,get instruction(){return`OR 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},execute(){const t=i.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=s(e.A.value,t)}}),this.addOperation({byteDefinition:182,cycleTime:2,byteLength:1,instruction:"OR (HL)",execute(){const t=i.memory.readByte(e.HL.value);e.A.value=s(e.A.value,t)}}),this.registers.baseRegisters.forEach((t=>{var r;this.addOperation({instruction:`XOR ${t.name}`,byteDefinition:(r=t.code,168+r),cycleTime:1,byteLength:1,execute(){e.A.value=n(e.A.value,t.value)}})})),this.addOperation({get instruction(){return`XOR 0x${i.memory.readByte(e.programCounter.value).toString(16)}`},byteDefinition:238,cycleTime:2,byteLength:2,execute(){const t=i.memory.readByte(e.programCounter.value);e.programCounter.value++,e.A.value=n(e.A.value,t)}}),this.addOperation({instruction:"XOR (HL)",byteDefinition:174,cycleTime:2,byteLength:1,execute(){const t=i.memory.readByte(e.HL.value);e.A.value=n(e.A.value,t)}})}},9879:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createRotateShiftOperations=void 0,t.createRotateShiftOperations=function(){const{registers:e}=this;this.addOperation({instruction:"RLCA",byteDefinition:7,cycleTime:1,byteLength:1,execute(){const t=e.A.value>>7;e.flags.CY=t,e.flags.H=0,e.flags.Z=0,e.flags.N=0,e.A.value=(e.A.value<<1)+t}}),this.addOperation({instruction:"RLA",byteDefinition:23,cycleTime:1,byteLength:1,execute(){const t=e.A.value>>7,r=(e.A.value<<1)+e.flags.CY;e.flags.CY=t,e.flags.H=0,e.flags.N=0,e.flags.Z=0,e.A.value=r}}),this.addOperation({instruction:"RRCA",byteDefinition:15,cycleTime:1,byteLength:1,execute(){const t=1&e.A.value;e.flags.CY=t,e.flags.H=0,e.flags.Z=0,e.flags.N=0,e.A.value=(e.A.value>>1)+(t<<7)}}),this.addOperation({instruction:"RRA",byteDefinition:31,cycleTime:1,byteLength:1,execute(){const t=1&e.A.value,r=(e.A.value>>1)+(e.flags.CY<<7);e.flags.CY=t,e.flags.H=0,e.flags.N=0,e.flags.Z=0,e.A.value=r}})}},9080:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dividerRegister=t.DividerRegister=void 0;const i=r(8254);class s{constructor(){this.offset=65284,this.name="DIV"}setValueFromCpuDivider(e){i.memory.writeByte(this.offset,e)}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,0)}}t.DividerRegister=s,t.dividerRegister=new s},9099:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.interruptEnableRegister=void 0;const i=r(8254);t.interruptEnableRegister=new class{constructor(){this.offset=65535,this.name="IE"}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}}},8543:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.interruptRequestRegister=void 0;const i=r(8254),s=r(5425);t.interruptRequestRegister=new class{constructor(){this.offset=65295,this.name="IF"}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}triggerVBlankInterruptRequest(){this.value=s.setBit(this.value,0,1)}triggerLcdStatusInterruptRequest(){this.value=s.setBit(this.value,1,1)}triggerTimerInterruptRequest(){this.value=s.setBit(this.value,2,1)}clearVBlankInterruptRequest(){this.value=s.clearBit(this.value,0)}clearLcdStatusInterruptRequest(){this.value=s.clearBit(this.value,1)}clearTimerOverflowInterruptRequest(){this.value=s.clearBit(this.value,2)}clearSerialTransferInterruptRequest(){this.value=s.clearBit(this.value,3)}clearP10P13NegativeEdgeInterruptRequest(){this.value=s.clearBit(this.value,4)}getInterruptFlags(e){return{isVerticalBlanking:1==(1&e),isLCDStatus:1==(e>>1&1),isTimerOverflow:1==(e>>2&1),isSerialTransferCompletion:1==(e>>3&1),isP10P13NegativeEdge:1==(e>>4&1)}}}},6584:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.timerControllerRegister=void 0;const i=r(8254);t.timerControllerRegister=new class{constructor(){this.offset=65287,this.name="TAC",this.inputClockSpeedValueToCycles=[1024,16,64,256]}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}get inputClockSpeed(){return 3&this.value}get cyclesForTimerUpdate(){return this.inputClockSpeedValueToCycles[this.inputClockSpeed]}get isTimerOn(){return 1==(this.value>>2&1)}}},4002:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.timerCounterRegister=t.TimerCounterRegister=void 0;const i=r(8254);class s{constructor(){this.offset=65285,this.name="TIMA"}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}}t.TimerCounterRegister=s,t.timerCounterRegister=new s},3120:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.timerModuloRegister=t.TimerModuloRegister=void 0;const i=r(8254);class s{constructor(){this.offset=65286,this.name="TMA"}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}}t.TimerModuloRegister=s,t.timerModuloRegister=new s},1007:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GPU=void 0;const i=r(8254),s=r(4311),n=r(5425),a=r(2169),o=r(6681),u=r(1388),l=r(1659),c=r(8947),g=r(46),d=r(8224),h=r(3069),y=r(6396),m=r(2806),f=r(6685),p=r(8958),v=r(8543);class C{constructor(){this.cycleCounter=0,this.windowLinesDrawn=0,this.colors=[{red:255,green:255,blue:255},{red:192,green:192,blue:192},{red:96,green:96,blue:96},{red:0,green:0,blue:0}],this.screen=new s.EnhancedImageData(C.ScreenWidth,C.ScreenHeight)}tick(e){switch(this.cycleCounter+=e,l.lcdStatusRegister.mode){case a.LcdStatusMode.SearchingOAM:this.cycleCounter>=C.CyclesPerScanlineOam&&(this.cycleCounter%=C.CyclesPerScanlineOam,l.lcdStatusRegister.mode=a.LcdStatusMode.TransferringDataToLCD);break;case a.LcdStatusMode.TransferringDataToLCD:this.cycleCounter>=C.CyclesPerScanlineVram&&(this.cycleCounter%=C.CyclesPerScanlineVram,l.lcdStatusRegister.isHBlankInterruptSelected&&v.interruptRequestRegister.triggerLcdStatusInterruptRequest(),l.lcdStatusRegister.isLineYCompareMatching=c.lineYRegister.value===g.lineYCompareRegister.value,l.lcdStatusRegister.isLineYMatchingInterruptSelected&&l.lcdStatusRegister.isLineYCompareMatching&&v.interruptRequestRegister.triggerLcdStatusInterruptRequest(),l.lcdStatusRegister.mode=a.LcdStatusMode.InHBlank);break;case a.LcdStatusMode.InHBlank:this.cycleCounter>=C.CyclesPerHBlank&&(this.drawScanline(),this.cycleCounter%=C.CyclesPerHBlank,c.lineYRegister.value++,c.lineYRegister.value===C.ScreenHeight?(l.lcdStatusRegister.mode=a.LcdStatusMode.InVBlank,v.interruptRequestRegister.triggerVBlankInterruptRequest()):l.lcdStatusRegister.mode=a.LcdStatusMode.SearchingOAM);break;case a.LcdStatusMode.InVBlank:this.cycleCounter>=C.CyclesPerScanline&&(l.lcdStatusRegister.isLineYCompareMatching=c.lineYRegister.value===g.lineYCompareRegister.value,l.lcdStatusRegister.isLineYMatchingInterruptSelected&&l.lcdStatusRegister.isLineYCompareMatching&&v.interruptRequestRegister.triggerLcdStatusInterruptRequest(),c.lineYRegister.value++,this.cycleCounter%=C.CyclesPerScanline,c.lineYRegister.value===C.HeightIncludingOffscreen&&(l.lcdStatusRegister.mode=a.LcdStatusMode.SearchingOAM,c.lineYRegister.value=0,this.windowLinesDrawn=0))}}drawScanline(){if(!d.lcdControlRegister.isLCDControllerOperating)return;let e=[];d.lcdControlRegister.isBackgroundDisplayOn&&(e=this.drawBackgroundLine());let t=[];d.lcdControlRegister.isWindowingOn&&(t=this.drawWindowLine()),d.lcdControlRegister.isObjOn&&this.drawSpriteLine(e,t)}drawBackgroundLine(){const e=[],t=d.lcdControlRegister.backgroundCharacterDataStartAddress,{backgroundTileMapStartAddress:r,backgroundCharacterData:s}=d.lcdControlRegister,a=0===s?i.memory.readSignedByte:i.memory.readByte,o=h.backgroundPaletteRegister.backgroundPalette,u=n.asUint8(c.lineYRegister.value+y.scrollYRegister.value);for(let s=0;s<C.ScreenWidth;s++)if(d.lcdControlRegister.isBackgroundDisplayOn){const l=n.asUint8(s+m.scrollXRegister.value),g=this.getTileIndexFromPixelLocation(l,u),h=this.getUpperLeftPixelLocationOfTile(g),y=l-h.x,f=2*(u-h.y),p=0===d.lcdControlRegister.backgroundCharacterData?128:0,v=t+16*(a(r+g)+p)+f,C=i.memory.readByte(v),R=i.memory.readByte(v+1),b=this.getPixelInTileLine(y,C,R,!1);e.push(b);const B=o[b],S=this.colors[B];this.screen.setPixel(s,c.lineYRegister.value,S.red,S.green,S.blue)}else{const t=o[0],r=this.colors[t];e.push(0),this.screen.setPixel(s,c.lineYRegister.value,r.red,r.green,r.blue)}return e}drawWindowLine(){if(c.lineYRegister.value<o.windowYRegister.value||u.windowXRegister.value>166)return[];const e=[];let t;const r=d.lcdControlRegister.windowTileMapStartAddress,s=d.lcdControlRegister.backgroundCharacterDataStartAddress,n=h.backgroundPaletteRegister.backgroundPalette;if(0===d.lcdControlRegister.backgroundCharacterData){const e=i.memory.memoryBytes.subarray(r,r+4096);t=new Int8Array(e)}else t=i.memory.memoryBytes.subarray(r,r+4096);const a=this.windowLinesDrawn,l=u.windowXRegister.value-7;for(let r=0;r<C.ScreenWidth;r++){if(r<l){e.push(0);continue}const o=r-l,u=this.getTileIndexFromPixelLocation(o,a),g=this.getUpperLeftPixelLocationOfTile(u),h=o-g.x,y=2*(a-g.y),m=0===d.lcdControlRegister.backgroundCharacterData?128:0,f=s+16*(t[u]+m)+y,p=i.memory.readByte(f),v=i.memory.readByte(f+1),C=this.getPixelInTileLine(h,p,v,!1);e.push(C);const R=n[C],b=this.colors[R];this.screen.setPixel(r,c.lineYRegister.value,b.red,b.green,b.blue)}return this.windowLinesDrawn++,e}drawSpriteLine(e,t){f.objectAttributeMemoryRegisters.filter((e=>{const{xPosition:t,yPosition:r}=e;if(0===t||0==r||t>=168||r>=160)return!1;const i=r+-16;let s=c.lineYRegister.value-i;const n=d.lcdControlRegister.objectHeight-1;return e.isFlippedVertical&&(s=n-s),s>=0&&s<=n})).slice(0,10).reverse().sort(((e,t)=>t.xPosition-e.xPosition)).forEach((r=>{const{xPosition:s,yPosition:a,characterCode:o,paletteNumber:u}=r,l=s+-8,g=a+-16;let h=c.lineYRegister.value-g;const y=d.lcdControlRegister.objectHeight-1;r.isFlippedVertical&&(h=y-h);const m=32768+16*(16===d.lcdControlRegister.objectHeight?n.clearBit(o,0):o)+2*h,f=i.memory.readByte(m),v=i.memory.readByte(m+1);for(let i=0;i<8;i++){const s=this.getPixelInTileLine(i,f,v,r.isFlippedHorizontal),n=p.objectPaletteRegisters[u].palette[s],a=this.colors[n],o=l+i,g=0!==e[o],d=void 0!==t[o]&&0!==t[o],h=r.isBehindBackground&&(g||d);0===s||h||this.screen.setPixel(l+i,c.lineYRegister.value,a.red,a.green,a.blue)}}))}getTileIndexFromPixelLocation(e,t){const r=Math.floor(e/8);return 32*Math.floor(t/8)+r}getUpperLeftPixelLocationOfTile(e){const t=Math.floor(e/32);return{x:8*(e-32*t),y:8*t}}getPixelInTileLine(e,t,r,i){const s=i?e:7-e;return n.getBit(t,s)+(n.getBit(r,s)<<1)}}t.GPU=C,C.ScreenWidth=160,C.ScreenHeight=144,C.HeightIncludingOffscreen=154,C.CyclesPerHBlank=204,C.CyclesPerScanlineOam=80,C.CyclesPerScanlineVram=172,C.CyclesPerScanline=C.CyclesPerHBlank+C.CyclesPerScanlineOam+C.CyclesPerScanlineVram,C.CyclesPerVBlank=4560,C.ScanlinesPerFrame=144,C.CyclesPerFrame=C.CyclesPerScanline*C.ScanlinesPerFrame+C.CyclesPerVBlank},3069:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.backgroundPaletteRegister=void 0;const i=r(8254);t.backgroundPaletteRegister=new class{constructor(){this.offset=65351,this.name="BGP"}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}get backgroundPalette(){const e=this.value;return[3&e,e>>2&3,e>>4&3,e>>6&3]}}},8078:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dmaTransferRegister=void 0;const i=r(8254);t.dmaTransferRegister=new class{constructor(){this.offset=65350,this.name="DMA"}get value(){return i.memory.readByte(this.offset)}}},8224:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lcdControlRegister=void 0;const i=r(8254),s=r(5425);t.lcdControlRegister=new class{constructor(){this.offset=65344,this.name="LCDC"}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}get isBackgroundDisplayOn(){return 1===s.getBit(this.value,0)}get isObjOn(){return 1===s.getBit(this.value,1)}get objectHeight(){return 0===s.getBit(this.value,2)?8:16}get backgroundCodeArea(){return s.getBit(this.value,3)}get backgroundCharacterData(){return s.getBit(this.value,4)}get windowCharacterData(){return this.backgroundCharacterData}get isWindowingOn(){return 1===s.getBit(this.value,5)}get windowCodeArea(){return s.getBit(this.value,6)}get windowTileMapStartAddress(){return 0===this.windowCodeArea?38912:39936}get backgroundTileMapStartAddress(){return 0===this.backgroundCodeArea?38912:39936}get backgroundCharacterDataStartAddress(){return 0===this.backgroundCharacterData?34816:32768}get isLCDControllerOperating(){return 1===s.getBit(this.value,7)}}},2169:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.LcdStatusMode=void 0,(r=t.LcdStatusMode||(t.LcdStatusMode={}))[r.InHBlank=0]="InHBlank",r[r.InVBlank=1]="InVBlank",r[r.SearchingOAM=2]="SearchingOAM",r[r.TransferringDataToLCD=3]="TransferringDataToLCD"},1659:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lcdStatusRegister=void 0;const i=r(8254),s=r(5425);t.lcdStatusRegister=new class{constructor(){this.offset=65345,this.name="STAT"}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}get mode(){return 3&this.value}set mode(e){let t=this.value;t=s.setBit(t,0,1&e),t=s.setBit(t,1,e>>1&1),this.value=t}get isLineYCompareMatching(){return 1===s.getBit(this.value,2)}set isLineYCompareMatching(e){this.value=s.setBit(this.value,2,e?1:0)}get isHBlankInterruptSelected(){return s.getBit(this.value,3)}get isLineYMatchingInterruptSelected(){return s.getBit(this.value,6)}}},46:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lineYCompareRegister=t.LineYCompareRegister=void 0;const i=r(8254);class s{constructor(){this.offset=65349,this.name="LYC"}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}}t.LineYCompareRegister=s,t.lineYCompareRegister=new s},8947:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lineYRegister=t.LineYRegister=void 0;const i=r(8254);class s{constructor(){this.offset=65348,this.name="LY"}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}}t.LineYRegister=s,t.lineYRegister=new s},6685:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectAttributeMemoryRegisters=t.ObjectAttributeMemoryRegister=void 0;const i=r(8254);class s{constructor(e){this.offset=e+s.StartOffset,this.name="OBJ"+e}getValueAt(e){if(e>=s.BytesPerRegister)throw new Error(`${this.name} Index out of bounds`);return i.memory.readByte(this.offset+e)}get yPosition(){return this.getValueAt(0)}get xPosition(){return this.getValueAt(1)}get characterCode(){return this.getValueAt(2)}get paletteNumber(){return this.getValueAt(3)>>4&1}get isFlippedHorizontal(){return 1==(this.getValueAt(3)>>5&1)}get isFlippedVertical(){return 1==(this.getValueAt(3)>>6&1)}get isBehindBackground(){return 1==(this.getValueAt(3)>>7&1)}}t.ObjectAttributeMemoryRegister=s,s.StartOffset=65024,s.EndOffset=65183,s.BytesPerRegister=4,t.objectAttributeMemoryRegisters=function(){const e=[],t=s.EndOffset-s.StartOffset;for(let r=0;r<=t;r+=s.BytesPerRegister)e.push(new s(r));return e}()},8958:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectPaletteRegisters=t.ObjectPaletteRegister=void 0;const i=r(8254);class s{constructor(e){this.offset=s.StartOffset+e,this.name="OBP"+e}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}get palette(){const e=this.value;return[3&e,e>>2&3,e>>4&3,e>>6&3]}}t.ObjectPaletteRegister=s,s.StartOffset=65352,t.objectPaletteRegisters=[new s(0),new s(1)]},2806:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scrollXRegister=t.ScrollXRegister=void 0;const i=r(8254);class s{constructor(){this.offset=65347,this.name="SCX"}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}}t.ScrollXRegister=s,t.scrollXRegister=new s},6396:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scrollYRegister=t.ScrollYRegister=void 0;const i=r(8254);class s{constructor(){this.offset=65346,this.name="SCY"}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}}t.ScrollYRegister=s,t.scrollYRegister=new s},1388:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.windowXRegister=t.WindowXRegister=void 0;const i=r(8254);class s{constructor(){this.offset=65355,this.name="WX"}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}}t.WindowXRegister=s,t.windowXRegister=new s},6681:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.windowYRegister=t.WindowYRegister=void 0;const i=r(8254);class s{constructor(){this.offset=65354,this.name="WY"}get value(){return i.memory.readByte(this.offset)}set value(e){i.memory.writeByte(this.offset,e)}}t.WindowYRegister=s,t.windowYRegister=new s},5425:(e,t)=>{function r(e,t){return e&~(1<<t)}function i(e){return 255&e}Object.defineProperty(t,"__esModule",{value:!0}),t.getUpperNibble=t.getLowerNibble=t.getMostSignificantByte=t.getLeastSignificantByte=t.convertUint8ToInt8=t.asUint16=t.asUint8=t.setBit=t.clearBit=t.getBit=void 0,t.getBit=function(e,t){return e>>t&1},t.clearBit=r,t.setBit=function(e,t,i){let s=r(e,t);return 1===i&&(s|=1<<t),s},t.asUint8=i,t.asUint16=function(e){return 65535&e},t.convertUint8ToInt8=function(e){return i(e)<<24>>24},t.getLeastSignificantByte=function(e){return 255&e},t.getMostSignificantByte=function(e){return e>>8&255},t.getLowerNibble=function(e){return 15&e},t.getUpperNibble=function(e){return e>>4&15}},4311:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EnhancedImageData=void 0;class r extends ImageData{setPixel(e,t,r,i,s,n=255){const a=t*this.width*4+4*e;this.data[a]=r,this.data[a+1]=i,this.data[a+2]=s,this.data[a+3]=n}}t.EnhancedImageData=r},2773:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.controllerManager=t.ControllerManager=t.Xbox360ControllerButtons=void 0;const i=r(7374);var s;!function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.LeftBumper=4]="LeftBumper",e[e.RightBumper=5]="RightBumper",e[e.LeftTrigger=6]="LeftTrigger",e[e.RightTrigger=7]="RightTrigger",e[e.Select=8]="Select",e[e.Start=9]="Start",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DpadUp=12]="DpadUp",e[e.DpadDown=13]="DpadDown",e[e.DpadLeft=14]="DpadLeft",e[e.DpadRight=15]="DpadRight"}(s=t.Xbox360ControllerButtons||(t.Xbox360ControllerButtons={}));class n{constructor(){this.controller=0,this.left=s.DpadLeft,this.right=s.DpadRight,this.up=s.DpadUp,this.down=s.DpadDown,this.select=s.Select,this.start=s.Start,this.b=s.X,this.a=s.A}queryButtons(){const e=navigator.getGamepads()[this.controller];e&&(i.input.isPressingLeft=e.buttons[this.left].pressed||e.axes[0]<-.1,i.input.isPressingRight=e.buttons[this.right].pressed||e.axes[0]>.1,i.input.isPressingUp=e.buttons[this.up].pressed||e.axes[1]<-.1,i.input.isPressingDown=e.buttons[this.down].pressed||e.axes[1]>.1,i.input.isPressingSelect=e.buttons[this.select].pressed,i.input.isPressingStart=e.buttons[this.start].pressed,i.input.isPressingB=e.buttons[this.b].pressed,i.input.isPressingA=e.buttons[this.a].pressed)}}t.ControllerManager=n,t.controllerManager=new n},7374:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.input=t.Input=void 0;const i=r(5425);class s{constructor(){this.isPressingUp=!1,this.isPressingDown=!1,this.isPressingLeft=!1,this.isPressingRight=!1,this.isPressingSelect=!1,this.isPressingStart=!1,this.isPressingA=!1,this.isPressingB=!1,this.isPollingDirections=!1,this.isPollingButtons=!1}setInputToCheck(e){this.isPollingButtons=1==(e>>4&1),this.isPollingDirections=1==(e>>5&1)}reportInput(){let e=15;return this.isPollingDirections&&(e=i.setBit(e,0,this.isPressingRight?0:1),e=i.setBit(e,1,this.isPressingLeft?0:1),e=i.setBit(e,2,this.isPressingUp?0:1),e=i.setBit(e,3,this.isPressingDown?0:1)),this.isPollingButtons&&(e=i.setBit(e,0,this.isPressingA?0:1),e=i.setBit(e,1,this.isPressingB?0:1),e=i.setBit(e,2,this.isPressingSelect?0:1),e=i.setBit(e,3,this.isPressingStart?0:1)),e=i.setBit(e,4,this.isPollingButtons?0:1),e=i.setBit(e,5,this.isPollingDirections?0:1),e}}t.Input=s,t.input=new s},7202:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.keyboardManager=t.KeyboardManager=void 0;const i=r(7374);class s{constructor(){this.down="ArrowDown",this.up="ArrowUp",this.left="ArrowLeft",this.right="ArrowRight",this.a="KeyA",this.b="KeyB",this.start="Enter",this.select="ControlRight",document.addEventListener("keydown",(e=>this.handleKeyEvent(e.code,!0))),document.addEventListener("keyup",(e=>this.handleKeyEvent(e.code,!1)))}handleKeyEvent(e,t){e===this.down&&(i.input.isPressingDown=t),e===this.up&&(i.input.isPressingUp=t),e===this.left&&(i.input.isPressingLeft=t),e===this.right&&(i.input.isPressingRight=t),e===this.a&&(i.input.isPressingA=t),e===this.b&&(i.input.isPressingB=t),e===this.start&&(i.input.isPressingStart=t),e===this.select&&(i.input.isPressingSelect=t)}}t.KeyboardManager=s,t.keyboardManager=new s},5281:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.controllerDataRegister=void 0;const i=r(8254);t.controllerDataRegister=new class{constructor(){this.offset=65280,this.name="P1"}get value(){return i.memory.readByte(this.offset)}get isPollingDirections(){return i.memory.readByte(this.offset)>>4&1}get isPollingButtons(){return i.memory.readByte(this.offset)>>5&1}}},3084:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dmaTransferController=void 0;const i=r(6685),s=r(8254),n=r(8078);class a{transfer(){const e=n.dmaTransferRegister.value*a.AddressInterval,t=i.objectAttributeMemoryRegisters.length*i.ObjectAttributeMemoryRegister.BytesPerRegister;for(let r=0;r<t;r++){const t=s.memory.readByte(e+r);s.memory.writeByte(i.ObjectAttributeMemoryRegister.StartOffset+r,t)}}}a.AddressInterval=256,t.dmaTransferController=new a},8254:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.memory=t.Memory=void 0;const i=r(3084),s=r(7374),n=r(9080),a=r(8078),o=r(5281),u=new ArrayBuffer(65536),l=new DataView(u),c=new Uint8Array(u);class g{insertCartridge(e){this.cartridge=e}get memoryBytes(){return c}reset(){c.fill(0,0,c.length-1)}readByte(e){return d(e)?this.cartridge?this.cartridge.readByte(e):0:h(e)?s.input.reportInput():l.getUint8(e)}readSignedByte(e){return d(e)?this.cartridge?this.cartridge.readSignedByte(e):0:l.getInt8(e)}readWord(e){return d(e)?this.cartridge?this.cartridge.readWord(e):0:l.getUint16(e,!0)}writeByte(e,t){d(e)?this.cartridge?.writeByte(e,t):h(e)?s.input.setInputToCheck(t):(e===n.dividerRegister.offset&&l.setUint8(n.dividerRegister.offset,0),l.setUint8(e,t),function(e){return e===a.dmaTransferRegister.offset}(e)&&i.dmaTransferController.transfer())}writeWord(e,t){d(e)?this.cartridge?.writeWord(e,t):l.setUint16(e,t,!0)}}function d(e){return e<=32767||e>=40960&&e<=49151}function h(e){return e===o.controllerDataRegister.offset}t.Memory=g,t.memory=new g}},t={};function r(i){if(t[i])return t[i].exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,r),s.exports}r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};(()=>{var e=i;Object.defineProperty(e,"X",{value:!0}),e.U=void 0;const t=r(1007),s=r(9145),n=r(8254),a=r(7374),o=r(5991),u=r(8224),l=r(2773),c=r(3426),g=r(7189),d=r(7202);e.U=class{constructor(){this.cpu=new s.CPU,this.gpu=new t.GPU,this.apu=new o.APU,this.memory=n.memory,this.fps=0,this.input=a.input,this.controllerManager=l.controllerManager,this.keyboardManager=d.keyboardManager,this.maxFps=60,this.interval=1e3/this.maxFps,this.cycles=0,this.previousTime=0,this.isRunning=!1}run(){this.isRunning||(this.isRunning=!0,this.cpu.initialize(),n.memory.reset(),u.lcdControlRegister.value=131,requestAnimationFrame((e=>this.runFrame(e))))}stop(){this.isRunning=!1}runFrame(e){if(!this.isRunning)return;const r=e-this.previousTime;if(r>=this.interval||!this.previousTime){for(this.fps=1e3/(e-this.previousTime),this.previousTime=e-r%this.interval;this.cycles<=t.GPU.CyclesPerFrame;){const e=this.cpu.tick();this.gpu.tick(e),this.apu.tick(e),this.cycles+=e}l.controllerManager.queryButtons(),this.frameFinishedCallback&&this.frameFinishedCallback(this.gpu.screen,this.fps,this.cpu.registers),this.cycles=this.cycles%t.GPU.CyclesPerFrame}requestAnimationFrame((e=>this.runFrame(e)))}onFrameFinished(e){this.frameFinishedCallback=e}loadGame(e){const t=g.CartridgeLoader.FromArrayBuffer(e);n.memory.insertCartridge(t),console.log("title: "+t.title),console.log("version: "+t.versionNumber),console.log("type: "+t.typeName),console.log("rom size: "+t.romSize),console.log("ram size: "+t.ramSize)}setCartridgeSaveRam(e){(n.memory.cartridge?.type===c.CartridgeType.MBC1_RAM_BATTERY||c.CartridgeType.MBC3_RAM_BATTERY)&&n.memory.cartridge.setRam(e)}getCartridgeSaveRam(){if(n.memory.cartridge?.type===c.CartridgeType.MBC1_RAM_BATTERY||c.CartridgeType.MBC3_RAM_BATTERY)return n.memory.cartridge.dumpRam()}setOnWriteToCartridgeRam(e){(n.memory.cartridge?.type===c.CartridgeType.MBC1_RAM_BATTERY||c.CartridgeType.MBC3_RAM_BATTERY)&&(n.memory.cartridge.onSramWrite=e)}get cartridge(){return n.memory.cartridge}}})();var s=i.U,n=i.X;export{s as Gameboy,n as __esModule};